import{aW as Je,r as p,aX as Ke,c as y,i as be,o as Qe,w as E,z as q,D as J,E as Ze,F as _e,G as ea,W as K,a5 as se,aq as Se,v as we,ak as Q,S as Re,y as Me}from"./element-plus-b1d7f0ee.js";function Be(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Function]"}function W(a,n,i,R=1){const[$,M]=typeof R=="number"?[R,R]:R,l=Math.round(n/$/a[0])*a[0],m=Math.round(i/M/a[1])*a[1];return[l,m]}function oe(a,n,i){return a-n-i}function re(a,n,i){return a-n-i}function P(a,n,i){return n!==null&&a<n?n:i!==null&&i<a?i:a}function ze(a,n,i){let R=a;const $=["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].find(M=>Be(R[M]));if(!Be(R[$]))return!1;do{if(R[$](n))return!0;if(R===i)return!1;R=R.parentNode}while(R);return!1}function aa(a){const n=window.getComputedStyle(a);return[parseFloat(n.getPropertyValue("width"),10),parseFloat(n.getPropertyValue("height"),10)]}function F(a,n,i){a&&(a.attachEvent?a.attachEvent("on"+n,i):a.addEventListener?a.addEventListener(n,i,!0):a["on"+n]=i)}function Ne(a,n,i){a&&(a.detachEvent?a.detachEvent("on"+n,i):a.removeEventListener?a.removeEventListener(n,i,!0):a["on"+n]=null)}const ta=["onMousedown","onTouchstart"],Pe={__name:"DraggableResizableVue3",props:{draggable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},x:{type:Number,default:0},y:{type:Number,default:0},z:{type:[String,Number],default:"auto",validator:a=>typeof a=="string"?a==="auto":a>=0},w:{type:[Number,String],validator:a=>typeof a=="number"?a>0:a==="auto"},h:{type:[Number,String],validator:a=>typeof a=="number"?a>0:a==="auto"},minWidth:{type:Number,default:0,validator:a=>a>=0},minHeight:{type:Number,default:0,validator:a=>a>=0},maxWidth:{type:Number,default:null,validator:a=>a>=0},maxHeight:{type:Number,default:null,validator:a=>a>=0},active:{type:Boolean,default:!1},preventDeactivation:{type:Boolean,default:!1},activeOnHover:{type:Boolean,default:!1},disableUserSelect:{type:Boolean,default:!0},enableNativeDrag:{type:Boolean,default:!1},lockAspectRatio:{type:Boolean,default:!1},handlesType:{type:String,default:"handles",validator:a=>["handles","borders","custom"].includes(a)},handles:{type:Array,default:()=>["tl","tm","tr","mr","br","bm","bl","ml"],validator:a=>{const n=new Set(["tl","tm","tr","mr","br","bm","bl","ml"]);return new Set(a.filter(i=>n.has(i))).size===a.length}},handlesSize:{type:Number,default:10},handlesBorder:{type:String,default:"0.5px solid #bbb"},dragHandle:{type:String,default:null},dragCancel:{type:String,default:null},axis:{type:String,default:"both",validator:a=>["x","y","both"].includes(a)},grid:{type:Array,validator:a=>Array.isArray(a)&&typeof a[0]=="number"&&typeof a[1]=="number"},showGrid:{type:[Boolean,String],default:!1,validator:a=>[!0,!1,"x","y","both"].includes(a)},gridColor:{type:String,default:"rgba(0, 0, 0, 0.1)"},parent:{type:[Boolean,String],default:!1},scale:{type:[Number,Array],default:1,validator:a=>typeof a=="number"?a>0:a.length===2&&a[0]>0&&a[1]>0},className:{type:String,default:"drv"},classNameDraggable:{type:String,default:"drv-draggable"},classNameResizable:{type:String,default:"drv-resizable"},classNameDragging:{type:String,default:"drv-dragging"},classNameResizing:{type:String,default:"drv-resizing"},classNameActive:{type:String,default:"drv-active"},classNameHandle:{type:String,default:"drv-handle"},onDragStart:{type:Function,default:()=>!0},onDrag:{type:Function,default:()=>!0},onResizeStart:{type:Function,default:()=>!0},onResize:{type:Function,default:()=>!0}},emits:["update:x","update:y","update:w","update:h","update:active","resizing","resizestop","dragging","dragstop","activated","deactivated"],setup(a,{emit:n}){Je(e=>({"5e95bfd6":Te.value,"5b3bff40":ke.value,"06804e30":Le.value}));const i={mouse:{start:"mousedown",move:"mousemove",stop:"mouseup"},touch:{start:"touchstart",move:"touchmove",stop:"touchend"}},R={userSelect:"none",MozUserSelect:"none",WebkitUserSelect:"none",MsUserSelect:"none"},$={userSelect:"auto",MozUserSelect:"auto",WebkitUserSelect:"auto",MsUserSelect:"auto"};let M=i.mouse;const l=a,m=n,z=p(null),V=p(null),D=p({h:"auto",w:"auto",active:!1,x:0,y:0}),ie=Ke(),h=y({get(){return l.w||D.value.w},set(e){m("update:w",e),D.value.w=e}}),x=y({get(){return l.h||D.value.h},set(e){m("update:h",e),D.value.h=e}}),r=y({get(){return l.x||D.value.x},set(e){m("update:x",e),D.value.x=e}}),s=y({get(){return l.y||D.value.y},set(e){m("update:y",e),D.value.y=e}}),v=p(null),c=p(null),C=y({get(){return l.active||D.value.active},set(e){m("update:active",e),D.value.active=e}}),Te=y(()=>l.handlesSize+"px"),Le=y(()=>l.handlesSize/2+"px"),ke=y(()=>l.handlesBorder),Z=p(!1),_=p(!1),b=p(null),T=p(null),L=p(null),B=p(null),A=p(!1),k=p(!1),ee=p(!1),ve=p(!1),d=p(null),o=p(null),De=y(()=>({transform:`translate(${r.value}px, ${s.value}px)`,width:Ae.value,height:$e.value,zIndex:l.z,...k.value&&l.disableUserSelect?R:$})),ce=be("drvContainerClass",{}),H=y(()=>ce.value?"."+ce.value:l.parent),ae=be("drvContainerGrid",{}),f=y(()=>!ae||!ae.value?l.grid||[1,1]:l.grid?l.grid:ae.value),He=y(()=>{const e={x:`linear-gradient(-90deg, ${l.gridColor} 1px, transparent 1px) 0px 0px / ${f.value[0]}px ${f.value[0]}px`,y:`linear-gradient(0deg, ${l.gridColor} 1px, transparent 1px) 0px 0px / ${f.value[1]}px ${f.value[1]}px`};return l.showGrid==="x"||l.showGrid==="y"?e[l.showGrid]:l.showGrid?`${e.x}, ${e.y}`:null}),Ce=y(()=>l.resizable?l.handles:[]),Ae=y(()=>h.value==="auto"&&!Z.value?"auto":h.value+"px"),$e=y(()=>x.value==="auto"&&!_.value?"auto":x.value+"px"),G=p(l.minWidth),Y=p(l.minHeight),S=p(l.maxWidth),w=p(l.maxHeight),de=y(()=>!!B.value&&(B.value.includes("l")||B.value.includes("r"))),me=y(()=>!!B.value&&(B.value.includes("t")||B.value.includes("b"))),te=()=>{d.value={mouseX:0,mouseY:0,x:0,y:0,w:0,h:0},o.value={minLeft:null,maxLeft:null,minRight:null,maxRight:null,minTop:null,maxTop:null,minBottom:null,maxBottom:null}},Xe=()=>{if(H.value){const e=typeof H.value=="string"?z.value.closest(H.value):z.value.parentNode;V.value=e;const u=window.getComputedStyle(e,null);return[parseInt(u.getPropertyValue("width"),10),parseInt(u.getPropertyValue("height"),10)]}return[null,null]},le=()=>{if(H.value&&l.showGrid){if(!V.value){const e=typeof e.value=="string"?z.value.closest(e.value):z.value.parentNode;V.value=e}V.value.style.background=He.value}},Ge=e=>{M=i.touch,fe(e)},Ye=e=>{M=i.mouse,fe(e)},fe=e=>{if(e instanceof MouseEvent&&e.which!==1)return;const u=e.target||e.srcElement;if(z.value.contains(u)){if(l.onDragStart(e)===!1)return;if(l.dragHandle&&!ze(u,l.dragHandle,z.value)||l.dragCancel&&ze(u,l.dragCancel,z.value)){k.value=!1;return}C.value||(C.value=!0,m("activated")),l.draggable&&(ee.value=!0),d.value.mouseX=e.touches?e.touches[0].pageX:e.pageX,d.value.mouseY=e.touches?e.touches[0].pageY:e.pageY,d.value.left=r.value,d.value.right=v.value,d.value.top=s.value,d.value.bottom=c.value,H.value&&(o.value=ue()),F(document.documentElement,M.move,We),F(document.documentElement,M.stop,he)}},ue=()=>({minLeft:r.value%f.value[0],maxLeft:Math.floor((T.value-h.value-r.value)/f.value[0])*f.value[0]+r.value,minRight:v.value%f.value[0],maxRight:Math.floor((T.value-h.value-v.value)/f.value[0])*f.value[0]+v.value,minTop:s.value%f.value[1],maxTop:Math.floor((L.value-x.value-s.value)/f.value[1])*f.value[1]+s.value,minBottom:c.value%f.value[1],maxBottom:Math.floor((L.value-x.value-c.value)/f.value[1])*f.value[1]+c.value}),ge=e=>{const u=e.target||e.srcElement,t=new RegExp(l.className+"-([trmbl]{2})","");(!z.value||!z.value.contains(u)&&!t.test(u.className))&&(C.value&&!l.preventDeactivation&&(C.value=!1,m("deactivated",e)),Ne(document.documentElement,M.move,U)),te()},Ee=(e,u)=>{M=i.touch,pe(e,u)},pe=(e,u)=>{u instanceof MouseEvent&&u.which!==1||l.onResizeStart(e,u)!==!1&&(u.stopPropagation&&u.stopPropagation(),l.lockAspectRatio&&!e.includes("m")?B.value="m"+e.substring(1):B.value=e,ve.value=!0,d.value.mouseX=u.touches?u.touches[0].pageX:u.pageX,d.value.mouseY=u.touches?u.touches[0].pageY:u.pageY,d.value.left=r.value,d.value.right=v.value,d.value.top=s.value,d.value.bottom=c.value,o.value=ne(),F(document.documentElement,M.move,U),F(document.documentElement,M.stop,he))},ne=()=>{const[e,u]=f.value;l.lockAspectRatio&&(G.value/Y.value>b.value?Y.value=G.value/b.value:G.value=b.value*Y.value,S.value&&w.value?(S.value=Math.min(S.value,b.value*w.value),w.value=Math.min(w.value,S.value/b.value)):S.value?w.value=S.value/b.value:w.value&&(S.value=b.value*w.value)),S.value=S.value-S.value%e,w.value=w.value-w.value%u;const t={minLeft:null,maxLeft:null,minTop:null,maxTop:null,minRight:null,maxRight:null,minBottom:null,maxBottom:null};return H.value?(t.minLeft=r.value%e,t.maxLeft=r.value+Math.floor((h.value-G.value)/e)*e,t.minTop=s.value%u,t.maxTop=s.value+Math.floor((x.value-Y.value)/u)*u,t.minRight=v.value%e,t.maxRight=v.value+Math.floor((h.value-G.value)/e)*e,t.minBottom=c.value%u,t.maxBottom=c.value+Math.floor((x.value-Y.value)/u)*u,S.value&&(t.minLeft=Math.max(t.minLeft,T.value-v.value-S.value),t.minRight=Math.max(t.minRight,T.value-r.value-S.value)),w.value&&(t.minTop=Math.max(t.minTop,L.value-c.value-w.value),t.minBottom=Math.max(t.minBottom,L.value-s.value-w.value)),l.lockAspectRatio&&(t.minLeft=Math.max(t.minLeft,r.value-s.value*b.value),t.minTop=Math.max(t.minTop,s.value-r.value/b.value),t.minRight=Math.max(t.minRight,v.value-c.value*b.value),t.minBottom=Math.max(t.minBottom,c.value-v.value/b.value))):(t.minLeft=null,t.maxLeft=r.value+Math.floor((h.value-G.value)/e)*e,t.minTop=null,t.maxTop=s.value+Math.floor((x.value-Y.value)/u)*u,t.minRight=null,t.maxRight=v.value+Math.floor((h.value-G.value)/e)*e,t.minBottom=null,t.maxBottom=c.value+Math.floor((x.value-Y.value)/u)*u,S.value&&(t.minLeft=-(v.value+S.value),t.minRight=-(r.value+S.value)),w.value&&(t.minTop=-(c.value+w.value),t.minBottom=-(s.value+w.value)),l.lockAspectRatio&&S.value&&w.value&&(t.minLeft=Math.min(t.minLeft,-(v.value+S.value)),t.minTop=Math.min(t.minTop,-(w.value+c.value)),t.minRight=Math.min(t.minRight,-r.value-S.value),t.minBottom=Math.min(t.minBottom,-s.value-w.value))),t},We=e=>{A.value?U(e):ee.value&&Fe(e)},Fe=e=>{const u=l.axis&&l.axis!=="y"?d.value.mouseX-(e.touches?e.touches[0].pageX:e.pageX):0,t=l.axis&&l.axis!=="x"?d.value.mouseY-(e.touches?e.touches[0].pageY:e.pageY):0,[g,N]=W(f.value,u,t,l.scale),X=P(d.value.left-g,o.value.minLeft,o.value.maxLeft),O=P(d.value.top-N,o.value.minTop,o.value.maxTop);if(l.onDrag(r,s)===!1)return;const j=P(d.value.right+g,o.value.minRight,o.value.maxRight),I=P(d.value.bottom+N,o.value.minBottom,o.value.maxBottom);r.value=X,s.value=O,v.value=j,c.value=I,m("dragging",r.value,s.value),k.value=!0},Ve=e=>{const[u]=W(f.value,e,s.value,1),t=P(u,o.value.minLeft,o.value.maxLeft);r.value=t,v.value=T.value-h.value-t},Ue=e=>{const[,u]=W(f.value,r.value,e,1),t=P(u,o.value.minTop,o.value.maxTop);s.value=t,c.value=L.value-x.value-t},U=e=>{let u=r.value,t=s.value,g=v.value,N=c.value;const X=d.value.mouseX-(e.touches?e.touches[0].pageX:e.pageX),O=d.value.mouseY-(e.touches?e.touches[0].pageY:e.pageY);!Z.value&&X&&(Z.value=!0),!_.value&&O&&(_.value=!0);const[j,I]=W(f.value,X,O,l.scale);B.value.includes("b")?(N=P(d.value.bottom+I,o.value.minBottom,o.value.maxBottom),l.lockAspectRatio&&me&&(g=v.value-(c.value-N)*b.value)):B.value.includes("t")&&(t=P(d.value.top-I,o.value.minTop,o.value.maxTop),l.lockAspectRatio&&me&&(u=r.value-(s.value-t)*b.value)),B.value.includes("r")?(g=P(d.value.right+j,o.value.minRight,o.value.maxRight),l.lockAspectRatio&&de&&(N=c.value-(v.value-g)/b.value)):B.value.includes("l")&&(u=P(d.value.left-j,o.value.minLeft,o.value.maxLeft),l.lockAspectRatio&&de&&(t=s.value-(r.value-u)/b.value));const xe=oe(T.value,u,g),ye=re(L.value,t,N);l.onResize(B.value,u,t,xe,ye)!==!1&&(r.value=u,s.value=t,v.value=g,c.value=N,h.value=xe,x.value=ye,m("resizing",r.value,s.value,h.value,x.value),A.value=!0)},Oe=e=>{const[u]=W(f.value,e,0,1);let t=P(T.value-u-r.value,o.value.minRight,o.value.maxRight),g=c.value;l.lockAspectRatio&&(g=c.value-(v.value-t)/b.value);const N=oe(T.value,r.value,t),X=re(L.value,s.value,g);v.value=t,c.value=g,h.value=N,x.value=X},je=e=>{const[,u]=W(f.value,0,e,1);let t=P(L.value-u-s.value,o.value.minBottom,o.value.maxBottom),g=v.value;l.lockAspectRatio&&(g=v.value-(c.value-t)*b.value);const N=oe(T.value,r.value,g),X=re(L.value,s.value,t);v.value=g,c.value=t,h.value=N,x.value=X},he=()=>{B.value=null,te(),ee.value=!1,ve.value=!1,A.value&&(A.value=!1,m("resizestop",r.value,s.value,h.value,x.value)),k.value&&(k.value=!1,m("dragstop",r.value,s.value)),Ne(document.documentElement,M.move,U)},Ie=()=>{l.activeOnHover&&(C.value=!0)},qe=()=>{l.activeOnHover&&!k.value&&(C.value=!1)};return Qe(()=>{te(),l.enableNativeDrag||(z.value.ondragstart=()=>!1);const[e,u]=Xe();T.value=e,L.value=u;const[t,g]=aa(z.value);b.value=(h.value!=="auto"?h.value:t)/(x.value!=="auto"?x.value:g),h.value=h.value!=="auto"?h.value:t,x.value=x.value!=="auto"?x.value:g,v.value=T.value-h.value-r.value,c.value=L.value-x.value-s.value,C.value&&m("activated"),l.showGrid&&le(),F(document.documentElement,"mousedown",ge),F(document.documentElement,"touchend touchcancel",ge)}),E(()=>l.x,e=>{A.value||k.value||(H.value&&(o.value=ue()),Ve(e))}),E(()=>l.y,e=>{A.value||k.value||(H.value&&(o.value=ue()),Ue(e))}),E(()=>l.lockAspectRatio,e=>{e?b.value=h.value/x.value:b.value=void 0}),E(()=>l.w,e=>{A.value||k.value||(H.value&&(o.value=ne()),Oe(e))}),E(()=>l.h,e=>{A.value||k.value||(H.value&&(o.value=ne()),je(e))}),E(()=>l.showGrid,()=>{le()}),E(()=>l.grid,()=>{le()}),(e,u)=>(q(),J("div",{ref_key:"el",ref:z,style:se(De.value),class:K([{[a.classNameActive]:C.value,[a.classNameDragging]:k.value,[a.classNameResizing]:A.value,[a.classNameDraggable]:a.draggable,[a.classNameResizable]:a.resizable},a.className]),onMousedown:Ye,onTouchstart:Ge,onMouseover:Ie,onMouseleave:qe},[Ze("div",{class:K("drv-"+a.handlesType)},[(q(!0),J(_e,null,ea(Ce.value,t=>(q(),J("div",{key:t,class:K([a.classNameHandle,a.classNameHandle+"-"+t,a.classNameHandle!=="drv-handle"?"drv-handle":"",a.classNameHandle!=="drv-handle"?"drv-handle-"+t:""]),style:se({display:C.value?"block":"none"}),onMousedown:Se(g=>pe(t,g),["stop","prevent"]),onTouchstart:Se(g=>Ee(t,g),["stop","prevent"])},[we(ie)["handle-"+t]?Q(e.$slots,"handle-"+t,{key:0}):Re("",!0),we(ie)["handle-"+t]?Re("",!0):Q(e.$slots,"handle",{key:1})],46,ta))),128))],2),Q(e.$slots,"default")],38))}},la={__name:"DraggableResizableContainer",props:{grid:{type:Array,default:()=>[1,1],validator:a=>Array.isArray(a)&&typeof a[0]=="number"&&typeof a[1]=="number"},showGrid:{type:[Boolean,String],default:!1,validator:a=>[!0,!1,"x","y","both"].includes(a)},gridColor:{type:String,default:"rgba(0, 0, 0, 0.1)"},className:{type:String,default:"drv-container"}},setup(a){const n=a,i=y(()=>n.grid),R=y(()=>n.className);Me("drvContainerClass",R),Me("drvContainerGrid",i);const $=p(null),M=y(()=>{const m={x:`linear-gradient(-90deg, ${n.gridColor} 1px, transparent 1px) 0px 0px / ${n.grid[0]}px ${n.grid[0]}px`,y:`linear-gradient(0deg, ${n.gridColor} 1px, transparent 1px) 0px 0px / ${n.grid[1]}px ${n.grid[1]}px`};return n.showGrid==="x"||n.showGrid==="y"?m[n.showGrid]:n.showGrid?`${m.x}, ${m.y}`:null}),l=y(()=>{const m={position:"relative"};return n.showGrid&&(m.background=M.value),m});return(m,z)=>(q(),J("div",{ref_key:"el",ref:$,style:se(l.value),class:K([R.value])},[Q(m.$slots,"default")],6))}};Pe.install=a=>(a.component("DraggableResizableVue",Pe),a.component("DraggableResizableContainer",la),a);export{Pe as _,la as a};
