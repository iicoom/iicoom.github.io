import{d as C,o as g,z as b,D as E,f as l,B as f,C as F,L as w}from"./element-plus-b1d7f0ee.js";const P=C({__name:"indexDB",setup(_){let r=null;const h=async()=>new Promise((n,e)=>{const t=indexedDB.open("FileTransferDB",1);t.onerror=()=>{e(new Error("Failed to open IndexedDB"))},t.onsuccess=()=>{r=t.result,n()},t.onupgradeneeded=d=>{const c=d.target.result;if(!c.objectStoreNames.contains("chunks")){const s=c.createObjectStore("chunks",{keyPath:"id",autoIncrement:!0});s.createIndex("transferId","transferId",{unique:!1}),s.createIndex("chunkIndex","chunkIndex",{unique:!1})}}}),I=async(n,e,t)=>{if(!r)throw new Error("IndexedDB not initialized");return new Promise((d,c)=>{const i=r.transaction(["chunks"],"readwrite").objectStore("chunks"),o={transferId:n,chunkIndex:e,data:t,timestamp:Date.now(),keyPath:0},a=i.add(o);a.onerror=()=>{c(new Error(`Failed to save chunk ${e}`))},a.onsuccess=()=>{d()}})},m=async n=>{if(!r)throw new Error("IndexedDB not initialized");return new Promise((e,t)=>{const s=r.transaction(["chunks"],"readonly").objectStore("chunks").index("transferId"),i=IDBKeyRange.only(n),o=s.getAll(i);o.onerror=()=>{t(new Error("Failed to read chunks from IndexedDB"))},o.onsuccess=()=>{const a=new Map;o.result.forEach(k=>{a.set(k.chunkIndex,k.data)}),e(a)}})},B=async n=>{if(!r)throw new Error("IndexedDB not initialized");return new Promise((e,t)=>{const s=r.transaction(["chunks"],"readwrite").objectStore("chunks").index("transferId"),i=IDBKeyRange.only(n),o=s.openCursor(i);o.onerror=()=>{t(new Error("Failed to clear chunks from IndexedDB"))},o.onsuccess=a=>{const u=a.target.result;u?(u.delete(),u.continue()):e()}})};let x=0;const D=async()=>{const n=new ArrayBuffer(8);new DataView(n).setFloat64(0,Math.PI,!0),await I("1245",x,n),x++},p=async()=>{const n=await m("1245");console.log("res",n)},y=async()=>{const n=await B("1245");console.log("res",n)};return g(()=>{h()}),(n,e)=>{const t=F("el-button");return b(),E("div",null,[l(t,{onClick:D},{default:f(()=>e[0]||(e[0]=[w("保存")])),_:1}),l(t,{onClick:p},{default:f(()=>e[1]||(e[1]=[w("读取")])),_:1}),l(t,{onClick:y},{default:f(()=>e[2]||(e[2]=[w("清空")])),_:1})])}}});export{P as default};
