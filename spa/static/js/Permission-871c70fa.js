import{d as G,r as k,k as w,z as S,D as O,E as y,f as o,B as s,A as j,S as z,v as r,ap as I,a7 as v,C as c,L as m,J,aq as E,ar as K}from"./element-plus-b1d7f0ee.js";import{g as L,$ as M,h as $,_ as W}from"./index-a31efbef.js";import"./echarts-71ab4440.js";const Y={class:"page-container"},H={class:"tool-bar"},Q={style:{height:"2000px"}},X={class:"custom-tree-node"},Z={style:{width:"300px",display:"inline-block"}},ee={class:"btn-group"},te={class:"dialog-footer"},oe=G({__name:"Permission",setup(le){const f=L(),g=k(!1),_=k(!1),q=k("新增"),b=k();let n=w({id:"",p_key:"",key:"",label:"",route:"",icon:""});const h=w({label:[{required:!0,message:"请输入权限名称"}],route:[{required:!0,message:"请输入路由"}],key:[{required:!0,message:"请输入键名"}],icon:[{required:!0,message:"请输入图标"}]}),A=async(t,e)=>{await M.sendRequest("DeletePermission",{id:e.id}),v({message:"操作成功",type:"success"}),f.setMenus([]);const a=await $.GetMenus();f.setMenus(a)},D=()=>{console.log("cancel!")},C=()=>{var t;_.value=!1,n=w({id:"",p_key:"",key:"",label:"",route:"",icon:""}),(t=b.value)==null||t.resetFields()};function B(t){_.value=!0,t&&t.id?n.p_key=t.key:n.p_key=""}function U(t){t&&t.validate(async(e,a)=>{if(e){let l="AddPermission";if(n.id?l="UpdatePermission":l="AddPermission",await M.sendRequest(l,n)){v({message:"操作成功",type:"success"}),C(),_.value=!1,f.setMenus([]);const u=await $.GetMenus();f.setMenus(u)}}else console.log("error submit!",a)})}function F(t){Object.keys(t).forEach(e=>{n[e]=t[e]}),q.value="编辑",_.value=!0}const N=(t,e,a,l)=>{g.value=!0,a==="inner"&&(t.data.p_key=e.data.key),["before","after"].includes(a)&&(t.data.p_key=e.data.p_key)};function R(){I.confirm("是否要保存当前排序?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{const t=[];function e(l,d){var p;let u=d.length?d.at(-1).id+1:1;d.push({id:u,key:l.key,p_key:l.p_key,label:l.label,route:l.route,icon:l.icon}),(p=l.children)!=null&&p.length&&l.children.forEach(V=>{e(V,d)})}f.menus.forEach(l=>{e(l,t)}),await M.sendRequest("SortPermission",t)&&v({type:"success",message:"操作成功"}),g.value=!1}).catch(t=>{v({type:"info",message:"canceled"})})}return(t,e)=>{const a=c("el-button"),l=c("el-popconfirm"),d=c("el-tree"),u=c("el-input"),p=c("el-form-item"),V=c("el-form"),T=c("el-dialog");return S(),O("div",Y,[y("div",H,[o(a,{type:"primary",onClick:B},{default:s(()=>e[7]||(e[7]=[m("新增")])),_:1}),g.value?(S(),j(a,{key:0,type:"primary",onClick:R},{default:s(()=>e[8]||(e[8]=[m("保存")])),_:1})):z("",!0)]),y("div",Q,[o(d,{data:r(f).menus,draggable:"","node-key":"id",onNodeDragEnd:N},{default:s(({node:i,data:x})=>[y("span",X,[y("span",Z,J(i.label),1),y("span",ee,[o(a,{type:"primary",text:"",onClick:E(P=>B(x),["stop"])},{default:s(()=>e[9]||(e[9]=[m("新增")])),_:2},1032,["onClick"]),o(a,{type:"primary",text:"",onClick:E(P=>F(x),["stop"])},{default:s(()=>e[10]||(e[10]=[m("编辑")])),_:2},1032,["onClick"]),o(l,{"confirm-button-text":"Yes","cancel-button-text":"No",icon:r(K),"icon-color":"#626AEF",title:"Are you sure to delete this?",onConfirm:P=>A(i,x),onCancel:D},{reference:s(()=>[o(a,{type:"danger",text:"",onClick:e[0]||(e[0]=E(()=>{},["stop"]))},{default:s(()=>e[11]||(e[11]=[m("删除")])),_:1})]),_:2},1032,["icon","onConfirm"])])])]),_:1},8,["data"]),o(T,{modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=i=>_.value=i),title:q.value,"close-on-click-modal":!1,onClose:C,center:"",width:"30%"},{footer:s(()=>[y("span",te,[o(a,{onClick:C},{default:s(()=>e[12]||(e[12]=[m("取消")])),_:1}),o(a,{type:"primary",onClick:e[5]||(e[5]=i=>U(b.value))},{default:s(()=>e[13]||(e[13]=[m(" 确认 ")])),_:1})])]),default:s(()=>[o(V,{model:r(n),ref_key:"ruleFormRef",ref:b,"label-width":"80px",rules:h},{default:s(()=>[o(p,{label:"权限名称",prop:"label"},{default:s(()=>[o(u,{modelValue:r(n).label,"onUpdate:modelValue":e[1]||(e[1]=i=>r(n).label=i),style:{width:"90%"}},null,8,["modelValue"])]),_:1}),o(p,{label:"路由",prop:"route"},{default:s(()=>[o(u,{modelValue:r(n).route,"onUpdate:modelValue":e[2]||(e[2]=i=>r(n).route=i),style:{width:"90%"}},null,8,["modelValue"])]),_:1}),o(p,{label:"键名",prop:"key"},{default:s(()=>[o(u,{modelValue:r(n).key,"onUpdate:modelValue":e[3]||(e[3]=i=>r(n).key=i),style:{width:"90%"}},null,8,["modelValue"])]),_:1}),o(p,{label:"图标",prop:"icon"},{default:s(()=>[o(u,{modelValue:r(n).icon,"onUpdate:modelValue":e[4]||(e[4]=i=>r(n).icon=i),style:{width:"90%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])])}}});const ie=W(oe,[["__scopeId","data-v-c324e36f"]]);export{ie as default};
