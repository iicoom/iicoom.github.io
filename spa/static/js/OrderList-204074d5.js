import{$ as w,G as C}from"./index-b38a4740.js";import{d as Y,o as Z,r as _,k as V,z as v,D as $,f as t,B as a,v as r,C as o,F as h,G as ee,L as i,J as y,A as L,E as te,a7 as S,ap as le}from"./element-plus-40d2da59.js";import"./echarts-71ab4440.js";const ae={class:"page-container"},ne={class:"dialog-footer"},ue=Y({__name:"OrderList",setup(oe){const u={page:1,pages:0,limit:10,sizes:[10,20,50,100],total:0};function G(n){u.limit=n,f()}function U(n){u.page=n,f()}Z(()=>{f()});const x=_();let m=V({title:"",category:"",status:""});function q(){var n;(n=x.value)==null||n.resetFields(),z()}function z(){u.page=1,f()}const F=_([]);async function f(){const n={page:u.page,limit:u.limit},e=await w.sendRequest("GetClientList",n);F.value=e.list,u.total=e.total}const T=[{label:"待支付",value:1},{label:"已支付",value:2},{label:"已失效",value:3}],M=C.arr2map(T),c=_(!1),E=_("VIP续期"),B=_();let d=V({});const N=V({valid_time:[{required:!0,message:"请选择"}]});function I(n){c.value=!0,d=n,console.log(d)}function k(){c.value=!1}function O(n){n&&n.validate(async(e,b)=>{e?await w.sendRequest("UpdateClientValidTime",d)&&(S({message:"操作成功",type:"success"}),k(),c.value=!1):console.log("error submit!",b)})}function P(n){le.confirm(`确定要删除【${n.id}】？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const e={id:n.id};await w.sendRequest("DeleteOrder",e)&&(S({type:"success",message:"操作成功"}),f())}).catch(()=>{})}return(n,e)=>{const b=o("el-input"),g=o("el-form-item"),j=o("el-option"),A=o("el-select"),p=o("el-button"),D=o("el-form"),s=o("el-table-column"),R=o("el-tag"),J=o("el-link"),H=o("el-table"),K=o("el-pagination"),Q=o("el-date-picker"),W=o("el-dialog");return v(),$("div",ae,[t(D,{model:r(m),ref_key:"searchFormRef",ref:x,inline:"",style:{"text-align":"left","margin-top":"10px"}},{default:a(()=>[t(g,{label:"标题"},{default:a(()=>[t(b,{placeholder:"请输入标题(模糊匹配)",modelValue:r(m).title,"onUpdate:modelValue":e[0]||(e[0]=l=>r(m).title=l),clearable:""},null,8,["modelValue"])]),_:1}),t(g,{label:"订单状态"},{default:a(()=>[t(A,{modelValue:r(m).status,"onUpdate:modelValue":e[1]||(e[1]=l=>r(m).status=l),clearable:"",placeholder:"",style:{width:"178px"}},{default:a(()=>[(v(),$(h,null,ee(T,l=>t(j,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(g,null,{default:a(()=>[t(p,{type:"primary",onClick:z},{default:a(()=>e[6]||(e[6]=[i("搜索")])),_:1}),t(p,{onClick:e[2]||(e[2]=l=>q())},{default:a(()=>e[7]||(e[7]=[i("重置")])),_:1})]),_:1})]),_:1},8,["model"]),t(H,{data:F.value,border:"",style:{width:"100%"}},{default:a(()=>[t(s,{prop:"id",label:"订单号",align:"center"}),t(s,{prop:"status",label:"订单状态",align:"center"},{default:a(l=>[i(y(r(M)[l.row.status]),1)]),_:1}),t(s,{prop:"username",label:"用户名",align:"center"}),t(s,{prop:"product_name",label:"商品",align:"center"}),t(s,{prop:"status",label:"类型",align:"center"},{default:a(l=>[l.row.pay_time?(v(),L(R,{key:0,type:"success"},{default:a(()=>e[8]||(e[8]=[i("VIP")])),_:1})):(v(),L(R,{key:1,type:"warning"},{default:a(()=>e[9]||(e[9]=[i("试用")])),_:1}))]),_:1}),t(s,{prop:"amount",label:"订单金额",align:"center"}),t(s,{label:"支付时间",align:"center",width:"110"},{default:a(l=>[i(y(r(C).formatTime(l.row.paid_time)),1)]),_:1}),t(s,{prop:"status",label:"状态",align:"center"},{default:a(l=>[i(y(new Date(l.row.valid_time).getTime()>Date.now()?"正常":"已过期"),1)]),_:1}),t(s,{label:"到期时间",align:"center",width:"110"},{default:a(l=>[i(y(r(C).formatTime(l.row.valid_time)),1)]),_:1}),t(s,{prop:"",label:"下载地址",align:"center"},{default:a(l=>[t(J,{href:l.row.config_dir,type:"primary",target:"_blank"},{default:a(()=>e[10]||(e[10]=[i("下载配置文件")])),_:2},1032,["href"])]),_:1}),t(s,{align:"center",label:"操作",fixed:"right",width:"140"},{default:a(l=>[t(p,{type:"primary",size:"small",onClick:X=>I(l.row)},{default:a(()=>e[11]||(e[11]=[i(" 续期 ")])),_:2},1032,["onClick"]),t(p,{type:"danger",size:"small",onClick:X=>P(l.row)},{default:a(()=>e[12]||(e[12]=[i("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),t(K,{layout:"total, sizes, prev, pager, next, jumper",onSizeChange:G,onCurrentChange:U,"current-page":u.page,"page-sizes":u.sizes,"page-size":u.limit,total:u.total},null,8,["current-page","page-sizes","page-size","total"]),t(W,{modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=l=>c.value=l),title:E.value,"close-on-click-modal":!1,onClose:k,center:"",width:"500px"},{footer:a(()=>[te("span",ne,[t(p,{onClick:k},{default:a(()=>e[13]||(e[13]=[i("取消")])),_:1}),t(p,{type:"primary",onClick:e[4]||(e[4]=l=>O(B.value))},{default:a(()=>e[14]||(e[14]=[i(" 确认 ")])),_:1})])]),default:a(()=>[t(D,{model:r(d),ref_key:"ruleFormRef",ref:B,"label-width":"120px",rules:N},{default:a(()=>[t(g,{label:"到期时间",prop:"valid_time"},{default:a(()=>[t(Q,{modelValue:r(d).valid_time,"onUpdate:modelValue":e[3]||(e[3]=l=>r(d).valid_time=l),type:"datetime",placeholder:"Select date and time"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{ue as default};
