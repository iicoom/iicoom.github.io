import{$ as w,G as x}from"./index-a31efbef.js";import{G as R}from"./index-3c3dae74.js";import{G as F}from"./index-0b5e2651.js";import{k as B,d as D,r as c,o as A,z as u,D as b,E as k,f as o,B as t,v as f,C as m,A as I,L as n,S as N,aB as z,F as E,G as M,J as s,ap as P,a7 as $}from"./element-plus-b1d7f0ee.js";import"./echarts-71ab4440.js";const q=B([{label:"",prop:"",type:"selection"},{label:"访客ID",prop:"visitorId",width:"200px"},{label:"标题",prop:"title"},{label:"referrer",prop:"referrer",width:"150px"},{label:"IP",prop:"ip",tdSlot:"ip",width:"150px",showTooltip:!1},{label:"area",prop:"location",tdSlot:"location",width:"300px"},{label:"UA",prop:"userAgent"},{label:"访问时间",prop:"create_time",tdSlot:"createTime",width:"200px",align:"center"}]),L=B([{field:"visitorId",type:"input",label:"访客ID"}]),j={class:"page-container"},J={class:"tool-bar"},K={style:{display:"flex",gap:"5px"}},Y=D({__name:"Visitors",setup(O){const y=c(),i=c();A(()=>{v()});function g(){i.value.pagination.page=1,v()}const h=c([]),_=c(!1);async function v(){_.value=!0;const r={...y.value.formFieldsValue,page:i.value.pagination.page,size:i.value.pagination.size},l=await w.sendRequest("GetVisitors",r);h.value=l.list,i.value.pagination.total=l.total,_.value=!1}const p=c([]),S=r=>{p.value=r.map(l=>l._id)},T=()=>{P.confirm(`确认要删除选中的 ${p.value.length} 条数据？`,"温馨提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await w.sendRequest("BatchRemoveVisitors",{ids:p.value})&&($({type:"success",message:"操作成功"}),g())}).catch(()=>{})};return(r,l)=>{const C=m("el-button"),d=m("el-tag"),G=m("el-link"),V=m("el-popover");return u(),b("div",j,[k("div",J,[o(F,{ref_key:"gtfRef",ref:y,"form-fields":f(L),onTableFilter:g},{btnAction:t(()=>[f(x).getPlatform()==="pc"?(u(),I(C,{key:0,type:"danger",disabled:!p.value.length,onClick:T},{default:t(()=>l[0]||(l[0]=[n(" 批量删除 ")])),_:1},8,["disabled"])):N("",!0)]),_:1},8,["form-fields"])]),o(R,{ref_key:"gtRef",ref:i,loading:_.value,columns:f(q),tableData:h.value,rowKey:"_id",onPageChange:v,onSizeChange:g,onSelectChange:S},{ip:t(a=>[o(V,{placement:"top",title:"位置信息",width:500,trigger:"hover"},z({reference:t(()=>[o(G,null,{default:t(()=>[n(s(a.row.ipAddress),1)]),_:2},1024)]),_:2},[a.row.location?{name:"default",fn:t(()=>[(u(!0),b(E,null,M(Object.keys(a.row.location),e=>(u(),b("div",{key:e,style:{"margin-top":"5px"}},[o(d,null,{default:t(()=>[n(s(e)+": "+s(a.row.location[e]),1)]),_:2},1024)]))),128))]),key:"0"}:void 0]),1024)]),location:t(a=>[k("span",K,[o(d,{type:"primary"},{default:t(()=>{var e;return[n(s((e=a.row.location)==null?void 0:e.country),1)]}),_:2},1024),o(d,{type:"success"},{default:t(()=>{var e;return[n(s((e=a.row.location)==null?void 0:e.regionName),1)]}),_:2},1024),o(d,{type:"warning"},{default:t(()=>{var e;return[n(s((e=a.row.location)==null?void 0:e.city),1)]}),_:2},1024)])]),createTime:t(a=>[n(s(f(x).formatTime(a.row.create_time)),1)]),_:1},8,["loading","columns","tableData"])])}}});export{Y as default};
