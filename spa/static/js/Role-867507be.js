import{g as X,$ as C}from"./index-8b747613.js";import{d as H,r as c,o as P,k as B,z as $,D as Q,E as x,f as l,B as a,X as W,A as Y,C as s,al as Z,L as f,v as d,J as ee,a7 as A,ap as te}from"./element-plus-b1d7f0ee.js";import"./echarts-71ab4440.js";const le={class:"page-container"},oe={class:"tool-bar"},ae={style:{width:"300px",display:"inline-block"}},ne={class:"dialog-footer"},ue=H({__name:"Role",setup(se){const r={page:1,pages:0,limit:10,sizes:[10,20,50,100],total:0};function q(t){r.limit=t,p()}function S(t){r.page=t,p()}const T=X(),m=c(!1),v=c("新增"),R=c();let g=[],_=[];P(()=>{p()});const k=c();let o=B({id:"",name:"",description:"",auth_list:[],half_list:[]});const E=B({name:[{required:!0,message:"请输入角色名称"}],description:[{required:!0,message:"请输入角色描述"}]}),F=t=>{t&&(t.resetFields(),g=[],_=[])};function L(t){t&&t.validate(async(e,u)=>{if(e){let i="AddRole";o.id?i="UpdateRole":i="AddRole",console.log(o),await C.sendRequest(i,o)&&(A({message:"操作成功",type:"success"}),y(t),p())}else console.log("error submit!",u)})}function U(t,e){o.auth_list=e.checkedKeys,o.half_list=e.halfCheckedKeys}function V(){m.value=!0}function y(t){F(t),Object.keys(o).forEach(e=>{o[e]=""}),m.value=!1}function j(){v.value="新增",V()}function M(t){v.value="编辑",g=t.half_list.split("|"),_=t.auth_list.split("|"),Object.keys(t).forEach(e=>{o[e]=t[e]}),o.half_list=g,o.auth_list=_,V()}const b=c(!1);async function p(){b.value=!0;const t=await C.sendRequest("GetRoles",{});R.value=t.list,r.total=t.total,b.value=!1}function N(t){te.confirm(`确定要删除角色【${t.name}】？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await C.sendRequest("DeleteRole",{id:t.id}),A({type:"success",message:"操作成功"}),p()}).catch(()=>{})}return(t,e)=>{const u=s("el-button"),i=s("el-table-column"),w=s("el-table"),K=s("el-pagination"),z=s("el-input"),h=s("el-form-item"),O=s("el-tree"),G=s("el-form"),I=s("el-dialog"),J=Z("loading");return $(),Q("div",le,[x("div",oe,[l(u,{type:"primary",onClick:j},{default:a(()=>e[6]||(e[6]=[f("新增")])),_:1})]),W(($(),Y(w,{data:R.value,border:"",style:{width:"100%"}},{default:a(()=>[l(i,{prop:"id",label:"ID",align:"center"}),l(i,{prop:"name",label:"角色名称",align:"center"}),l(i,{prop:"description",label:"角色描述",align:"center"}),l(i,{align:"center",label:"操作"},{default:a(n=>[l(u,{onClick:D=>M(n.row)},{default:a(()=>e[7]||(e[7]=[f("编辑")])),_:2},1032,["onClick"]),l(u,{type:"danger",onClick:D=>N(n.row)},{default:a(()=>e[8]||(e[8]=[f("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,b.value]]),l(K,{layout:"total, sizes, prev, pager, next, jumper",onSizeChange:q,onCurrentChange:S,"current-page":r.page,"page-sizes":r.sizes,"page-size":r.limit,total:r.total},null,8,["current-page","page-sizes","page-size","total"]),l(I,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=n=>m.value=n),title:v.value,center:"","close-on-click-modal":!1,"destroy-on-close":"",width:"40%",onClose:e[5]||(e[5]=n=>y(k.value))},{footer:a(()=>[x("span",ne,[l(u,{onClick:e[2]||(e[2]=n=>y(k.value))},{default:a(()=>e[9]||(e[9]=[f("取消")])),_:1}),l(u,{type:"primary",onClick:e[3]||(e[3]=n=>L(k.value))},{default:a(()=>e[10]||(e[10]=[f("确认")])),_:1})])]),default:a(()=>[l(G,{model:d(o),ref_key:"ruleFormRef",ref:k,"label-width":"80px","label-position":"top",rules:E},{default:a(()=>[l(h,{label:"角色名称",prop:"name"},{default:a(()=>[l(z,{modelValue:d(o).name,"onUpdate:modelValue":e[0]||(e[0]=n=>d(o).name=n)},null,8,["modelValue"])]),_:1}),l(h,{label:"角色描述",prop:"description"},{default:a(()=>[l(z,{modelValue:d(o).description,"onUpdate:modelValue":e[1]||(e[1]=n=>d(o).description=n),type:"textarea"},null,8,["modelValue"])]),_:1}),l(h,{label:"权限设置",prop:"key"},{default:a(()=>[l(O,{"node-key":"key","show-checkbox":"","check-on-click-node":"",data:d(T).menus,"default-expanded-keys":d(g),"default-checked-keys":d(_),onCheck:U},{default:a(({node:n,data:D})=>[x("span",ae,ee(n.label),1)]),_:1},8,["data","default-expanded-keys","default-checked-keys"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{ue as default};
