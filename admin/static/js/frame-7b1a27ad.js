import{d as E,r as v,o as C,z as L,D as x,E as u,f as p,B as k,C as h,L as w}from"./element-plus-b1d7f0ee.js";import{_ as T}from"./index-a763790d.js";import"./echarts-71ab4440.js";const B=["src"],I=E({__name:"frame",setup(V){const m=v(0),f=v(""),g=()=>{const e=document.getElementById("video"),t=document.getElementById("canvas"),r=t.getContext("2d"),s=()=>{r.drawImage(e,0,0,t.width,t.height);const l=t.toDataURL("image/jpeg",.7);f.value=l,e.removeEventListener("seeked",s)};e.addEventListener("seeked",s),e.currentTime=m.value};return C(()=>{const e=document.getElementById("video"),t=document.getElementById("canvas"),r=t.getContext("2d"),s=document.getElementById("thumbnailContainer");function l(){t.width=e.videoWidth,t.height=e.videoHeight}function _(n){return new Promise(a=>{const o=()=>{r.drawImage(e,0,0,t.width,t.height);const d=t.toDataURL("image/jpeg",.7);a({time:n,url:d}),e.removeEventListener("seeked",o)};e.addEventListener("seeked",o),e.currentTime=n})}async function b(n=1){if(!e.duration||e.duration<=0)return;const a=Math.floor(e.duration);for(let o=0;o<=a;o+=n){const d=await _(o),i=document.createElement("img");i.src=d.url,i.className="thumbnail",i.dataset.time=d.time,i.addEventListener("click",()=>{e.currentTime=parseFloat(i.dataset.time),c(i)}),s.appendChild(i)}c(s.querySelector(".thumbnail"))}function c(n){document.querySelectorAll(".thumbnail").forEach(a=>{a.classList.remove("active")}),n&&n.classList.add("active")}function y(){const n=Math.floor(e==null?void 0:e.currentTime),a=Array.from(document.querySelectorAll(".thumbnail")).find(o=>Math.abs(parseFloat(o.dataset.time)-n)<1);a&&c(a)}e==null||e.addEventListener("loadeddata",async()=>{l(),await b(1)}),e==null||e.addEventListener("timeupdate",()=>{y()})}),(e,t)=>{const r=h("el-input-number"),s=h("el-button");return L(),x("div",null,[t[2]||(t[2]=u("div",{id:"thumbnailContainer"},null,-1)),t[3]||(t[3]=u("canvas",{id:"canvas",style:{display:"none"}},null,-1)),p(r,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=l=>m.value=l)},null,8,["modelValue"]),u("img",{src:f.value,class:"w-[100px]"},null,8,B),p(s,{onClick:g},{default:k(()=>t[1]||(t[1]=[w("抽取图片")])),_:1})])}}});const M=T(I,[["__scopeId","data-v-52f5f130"]]);export{M as default};
