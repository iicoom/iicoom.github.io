import{$ as b,G as x,a as Y,_ as Z}from"./index-a763790d.js";import{d as ee,r as C,o as te,k as le,c as ae,z as y,D as w,f as a,B as n,v as u,A as L,X as ne,L as s,J as p,C as r,al as oe,F as R,G as S,S as se,E as ie,ap as k,a7 as z}from"./element-plus-b1d7f0ee.js";import"./echarts-71ab4440.js";const re={class:"page-container"},ce={key:1,class:"load-more"},ue=ee({__name:"ArticleList",setup(pe){const F=Y(),o={page:1,pages:0,limit:10,sizes:[10,20,50,100],total:0};function q(t){o.limit=t,f()}function D(t){o.page=t,f()}const d=C([]),G=[{label:"后端",value:"后端"},{label:"前端",value:"前端"},{label:"移动端",value:"移动端"},{label:"数据库",value:"数据库"},{label:"算法",value:"算法"},{label:"架构",value:"架构"},{label:"其他",value:"其他"}];te(()=>{if(console.log(A),A==="pc")f();else{const t=document.querySelector(".load-more");U.observe(t)}});const $=C();let m=le({title:"",category:""});function I(){var t;(t=$.value)==null||t.resetFields(),B()}function B(){o.page=1,f()}async function f(){const t={...m,page:o.page,limit:o.limit},e=await b.sendRequest("GetArticleList",t);d.value=e.list,o.total=e.total}function E(t){k.confirm(`确定要删除【${t.title}】？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await b.sendRequest("RemoveArticle",{id:t.id})&&(z({type:"success",message:"操作成功"}),f())}).catch(()=>{})}function M(t){let e=t.status===1?"禁用":"启用";k.confirm(`确定要${e}【${t.title}】？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const c={id:t.id};t.status===1?c.status=2:c.status=1,await b.sendRequest("UpdateArticleStatus",c)&&(z({type:"success",message:"操作成功"}),f())}).catch(()=>{})}function N(t){let e=t.top===1?"置顶":"取消置顶";k.confirm(`确定要${e}【${t.title}】？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{const c={id:t.id};t.top===1?c.top=2:c.top=1,await b.sendRequest("UpdateArticleTop",c)&&(z({type:"success",message:"操作成功"}),f())}).catch(()=>{})}function T(t){F.push({name:"ArticleInfo",params:{id:t.id}})}const A=x.getPlatform(),h=C(!1),U=new IntersectionObserver(async t=>{t[0].isIntersecting&&j()},{root:null,threshold:0}),V=ae(()=>{if(d.value.length<10)return"";if(d.value.length<o.total)return"加载更多";if(d.value.length>=o.total)return"没有更多数据"});let P=0;async function j(){if(V.value==="没有更多数据")return;h.value=!0;const t={...m,page:P+=1,limit:o.limit},e=await b.sendRequest("GetArticleList",t,{},null);d.value=d.value.concat(e.list),o.total=e.total,h.value=!1}return(t,e)=>{const c=r("el-input"),v=r("el-form-item"),J=r("el-option"),O=r("el-select"),g=r("el-button"),X=r("el-form"),i=r("el-table-column"),H=r("el-tag"),K=r("el-table"),Q=r("el-pagination"),W=oe("loading");return y(),w("div",re,[a(X,{model:u(m),ref_key:"searchFormRef",ref:$,inline:"",style:{"text-align":"left","margin-top":"10px"}},{default:n(()=>[a(v,{label:"标题",prop:"title"},{default:n(()=>[a(c,{placeholder:"请输入标题(模糊匹配)",modelValue:u(m).title,"onUpdate:modelValue":e[0]||(e[0]=l=>u(m).title=l),clearable:"",style:{"min-width":"168px"}},null,8,["modelValue"])]),_:1}),a(v,{label:"分类",prop:"category"},{default:n(()=>[a(O,{modelValue:u(m).category,"onUpdate:modelValue":e[1]||(e[1]=l=>u(m).category=l),clearable:"",placeholder:"请选择分类",style:{"min-width":"168px"}},{default:n(()=>[(y(),w(R,null,S(G,l=>a(J,{key:l.type,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(v,null,{default:n(()=>[a(g,{type:"primary",onClick:B},{default:n(()=>e[4]||(e[4]=[s("搜索")])),_:1}),a(g,{onClick:e[2]||(e[2]=l=>I())},{default:n(()=>e[5]||(e[5]=[s("重置")])),_:1}),a(g,{type:"primary",onClick:e[3]||(e[3]=l=>T({id:0}))},{default:n(()=>e[6]||(e[6]=[s("新增")])),_:1})]),_:1})]),_:1},8,["model"]),a(K,{data:d.value,border:"",style:{width:"100%"}},{default:n(()=>[a(i,{prop:"id",label:"ID",align:"center",width:"80px"}),a(i,{prop:"title",label:"标题",align:"center"}),a(i,{align:"center",prop:"category",label:"分类"}),a(i,{label:"标签",align:"center"},{default:n(l=>[l.row.tags.length?(y(!0),w(R,{key:0},S(l.row.tags.split(","),_=>(y(),L(H,{key:_,style:{margin:"0 5px 5px 0"}},{default:n(()=>[s(p(_),1)]),_:2},1024))),128)):se("",!0)]),_:1}),a(i,{prop:"view_count",label:"浏览量",align:"center"}),a(i,{prop:"status",label:"状态",align:"center"},{default:n(l=>[s(p(l.row.status===1?"正常":"禁用"),1)]),_:1}),a(i,{prop:"status",label:"是否置顶",align:"center"},{default:n(l=>[s(p(l.row.top===1?"否":"是"),1)]),_:1}),a(i,{label:"创建时间",align:"center",width:"110"},{default:n(l=>[s(p(u(x).formatTime(l.row.create_time)),1)]),_:1}),a(i,{label:"修改时间",align:"center",width:"110"},{default:n(l=>[s(p(u(x).formatTime(l.row.update_time)),1)]),_:1}),a(i,{align:"center",label:"操作",fixed:"right",width:"155px"},{default:n(l=>[a(g,{type:"primary",size:"small",onClick:_=>T(l.row)},{default:n(()=>e[7]||(e[7]=[s("编辑")])),_:2},1032,["onClick"]),a(g,{type:"primary",size:"small",onClick:_=>M(l.row)},{default:n(()=>[s(p(l.row.status===1?"禁用":"启用"),1)]),_:2},1032,["onClick"]),e[9]||(e[9]=ie("div",{style:{height:"5px"}},null,-1)),a(g,{type:"primary",size:"small",onClick:_=>N(l.row)},{default:n(()=>[s(p(l.row.top===1?"置顶":"取消"),1)]),_:2},1032,["onClick"]),a(g,{type:"danger",size:"small",onClick:_=>E(l.row)},{default:n(()=>e[8]||(e[8]=[s("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),u(x).getPlatform()==="pc"?(y(),L(Q,{key:0,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:q,onCurrentChange:D,"current-page":o.page,"page-sizes":o.sizes,"page-size":o.limit,total:o.total},null,8,["current-page","page-sizes","page-size","total"])):ne((y(),w("div",ce,[s(p(V.value),1)])),[[W,h.value]])])}}});const ge=Z(ue,[["__scopeId","data-v-5b4c615c"]]);export{ge as default};
