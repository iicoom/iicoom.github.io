import{l as kt}from"./index-d9998155.js";import{c as J,S as Ot,e as A,G as at,n as tt,m as X,M as q,v as Pt,a as gt,b as pt,C as wt,F as xt,N as st,s as z,t as bt,i as _t,u as It,a7 as Wt,a8 as et,L as Et,p as it,a9 as St,w as Mt,P as Dt}from"./index-a22f7fa8.js";import{d as G,r as P,c as B,av as Ht,f as g,w as nt,aK as Bt,q as ct,o as Nt,z as rt,D as ut,E as H,S as Vt,B as $t,v as dt,C as Lt}from"./element-plus-40d2da59.js";import{_ as Rt}from"./index-842d9a02.js";import"./echarts-71ab4440.js";const[Yt,D,ft]=J("picker"),Tt=e=>e.find(s=>!s.disabled)||e[0];function At(e,s){const a=e[0];if(a){if(Array.isArray(a))return"multiple";if(s.children in a)return"cascade"}return"default"}function j(e,s){s=at(s,0,e.length);for(let a=s;a<e.length;a++)if(!e[a].disabled)return a;for(let a=s-1;a>=0;a--)if(!e[a].disabled)return a;return 0}const mt=(e,s,a)=>s!==void 0&&!!e.find(d=>d[a.value]===s);function lt(e,s,a){const d=e.findIndex(x=>x[a.value]===s),r=j(e,d);return e[r]}function Ut(e,s,a){const d=[];let r={[s.children]:e},x=0;for(;r&&r[s.children];){const b=r[s.children],w=a.value[x];if(r=Ot(w)?lt(b,w,s):void 0,!r&&b.length){const m=Tt(b)[s.value];r=lt(b,m,s)}x++,d.push(b)}return d}function Ft(e){const{transform:s}=window.getComputedStyle(e),a=s.slice(7,s.length-1).split(", ")[5];return Number(a)}function Kt(e){return A({text:"text",value:"value",children:"children"},e)}const vt=200,ht=300,Xt=15,[Ct,ot]=J("picker-column"),yt=Symbol(Ct);var zt=G({name:Ct,props:{value:tt,fields:X(Object),options:q(),readonly:Boolean,allowHtml:Boolean,optionHeight:X(Number),swipeDuration:X(tt),visibleOptionNum:X(tt)},emits:["change","clickOption","scrollInto"],setup(e,{emit:s,slots:a}){let d,r,x,b,w;const m=P(),T=P(),h=P(0),t=P(0),_=Pt(),I=()=>e.options.length,L=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,W=u=>{let o=j(e.options,u);const l=-o*e.optionHeight,c=()=>{o>I()-1&&(o=j(e.options,u));const O=e.options[o][e.fields.value];O!==e.value&&s("change",O)};d&&l!==h.value?w=c:c(),h.value=l},C=()=>e.readonly||!e.options.length,U=u=>{d||C()||(w=null,t.value=vt,W(u),s("clickOption",e.options[u]))},E=u=>at(Math.round(-u/e.optionHeight),0,I()-1),R=B(()=>E(h.value)),F=(u,o)=>{const l=Math.abs(u/o);u=h.value+l/.003*(u<0?-1:1);const c=E(u);t.value=+e.swipeDuration,W(c)},N=()=>{d=!1,t.value=0,w&&(w(),w=null)},K=u=>{if(!C()){if(_.start(u),d){const o=Ft(T.value);h.value=Math.min(0,o-L())}t.value=0,r=h.value,x=Date.now(),b=r,w=null}},Y=u=>{if(C())return;_.move(u),_.isVertical()&&(d=!0,xt(u,!0));const o=at(r+_.deltaY.value,-(I()*e.optionHeight),e.optionHeight),l=E(o);l!==R.value&&s("scrollInto",e.options[l]),h.value=o;const c=Date.now();c-x>ht&&(x=c,b=o)},V=()=>{if(C())return;const u=h.value-b,o=Date.now()-x;if(o<ht&&Math.abs(u)>Xt){F(u,o);return}const c=E(h.value);t.value=vt,W(c),setTimeout(()=>{d=!1},0)},S=()=>{const u={height:`${e.optionHeight}px`};return e.options.map((o,l)=>{const c=o[e.fields.text],{disabled:O}=o,n=o[e.fields.value],i={role:"button",style:u,tabindex:O?-1:0,class:[ot("item",{disabled:O,selected:n===e.value}),o.className],onClick:()=>U(l)},f={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:c};return g("li",i,[a.option?a.option(o,l):g("div",f,null)])})};return gt(yt),pt({stopMomentum:N}),Ht(()=>{const u=d?Math.floor(-h.value/e.optionHeight):e.options.findIndex(c=>c[e.fields.value]===e.value),o=j(e.options,u),l=-o*e.optionHeight;d&&o<u&&N(),h.value=l}),wt("touchmove",Y,{target:m}),()=>g("div",{ref:m,class:ot(),onTouchstartPassive:K,onTouchend:V,onTouchcancel:V},[g("ul",{ref:T,style:{transform:`translate3d(0, ${h.value+L()}px, 0)`,transitionDuration:`${t.value}ms`,transitionProperty:t.value?"all":"none"},class:ot("wrapper"),onTransitionend:N},[S()])])}});const[jt]=J("picker-toolbar"),Q={title:String,cancelButtonText:String,confirmButtonText:String},qt=["cancel","confirm","title","toolbar"],Jt=Object.keys(Q);var Gt=G({name:jt,props:Q,emits:["confirm","cancel"],setup(e,{emit:s,slots:a}){const d=()=>{if(a.title)return a.title();if(e.title)return g("div",{class:[D("title"),"van-ellipsis"]},[e.title])},r=()=>s("cancel"),x=()=>s("confirm"),b=()=>{var m;const T=(m=e.cancelButtonText)!=null?m:ft("cancel");if(!(!a.cancel&&!T))return g("button",{type:"button",class:[D("cancel"),st],onClick:r},[a.cancel?a.cancel():T])},w=()=>{var m;const T=(m=e.confirmButtonText)!=null?m:ft("confirm");if(!(!a.confirm&&!T))return g("button",{type:"button",class:[D("confirm"),st],onClick:x},[a.confirm?a.confirm():T])};return()=>g("div",{class:D("toolbar")},[a.toolbar?a.toolbar():[b(),d(),w()]])}});const[Qt,me]=J("picker-group"),Zt=Symbol(Qt);A({tabs:q(),activeTab:z(0),nextStepText:String,showToolbar:bt},Q);const te=A({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:z(44),showToolbar:bt,swipeDuration:z(1e3),visibleOptionNum:z(6)},Q),ee=A({},te,{columns:q(),modelValue:q(),toolbarPosition:_t("top"),columnsFieldNames:Object});var ne=G({name:Yt,props:ee,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:s,slots:a}){const d=P(),r=P(e.modelValue.slice(0)),{parent:x}=gt(Zt),{children:b,linkChildren:w}=It(yt);w();const m=B(()=>Kt(e.columnsFieldNames)),T=B(()=>Wt(e.optionHeight)),h=B(()=>At(e.columns,m.value)),t=B(()=>{const{columns:o}=e;switch(h.value){case"multiple":return o;case"cascade":return Ut(o,m.value,r);default:return[o]}}),_=B(()=>t.value.some(o=>o.length)),I=B(()=>t.value.map((o,l)=>lt(o,r.value[l],m.value))),L=B(()=>t.value.map((o,l)=>o.findIndex(c=>c[m.value.value]===r.value[l]))),W=(o,l)=>{if(r.value[o]!==l){const c=r.value.slice(0);c[o]=l,r.value=c}},C=()=>({selectedValues:r.value.slice(0),selectedOptions:I.value,selectedIndexes:L.value}),U=(o,l)=>{W(l,o),h.value==="cascade"&&r.value.forEach((c,O)=>{const n=t.value[O];mt(n,c,m.value)||W(O,n.length?n[0][m.value.value]:void 0)}),ct(()=>{s("change",A({columnIndex:l},C()))})},E=(o,l)=>{const c={columnIndex:l,currentOption:o};s("clickOption",A(C(),c)),s("scrollInto",c)},R=()=>{b.forEach(l=>l.stopMomentum());const o=C();return ct(()=>{s("confirm",o)}),o},F=()=>s("cancel",C()),N=()=>t.value.map((o,l)=>g(zt,{value:r.value[l],fields:m.value,options:o,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:T.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:c=>U(c,l),onClickOption:c=>E(c,l),onScrollInto:c=>{s("scrollInto",{currentOption:c,columnIndex:l})}},{option:a.option})),K=o=>{if(_.value){const l={height:`${T.value}px`},c={backgroundSize:`100% ${(o-T.value)/2}px`};return[g("div",{class:D("mask"),style:c},null),g("div",{class:[St,D("frame")],style:l},null)]}},Y=()=>{const o=T.value*+e.visibleOptionNum,l={height:`${o}px`};return!e.loading&&!_.value&&a.empty?a.empty():g("div",{ref:d,class:D("columns"),style:l},[N(),K(o)])},V=()=>{if(e.showToolbar&&!x)return g(Gt,Bt(it(e,Jt),{onConfirm:R,onCancel:F}),it(a,qt))};nt(t,o=>{o.forEach((l,c)=>{l.length&&!mt(l,r.value[c],m.value)&&W(c,Tt(l)[m.value.value])})},{immediate:!0});let S;return nt(()=>e.modelValue,o=>{!et(o,r.value)&&!et(o,S)&&(r.value=o.slice(0),S=o.slice(0))},{deep:!0}),nt(r,o=>{et(o,e.modelValue)||(S=o.slice(0),s("update:modelValue",S))},{immediate:!0}),wt("touchmove",xt,{target:d}),pt({confirm:R,getSelectedOptions:()=>I.value}),()=>{var o,l;return g("div",{class:D()},[e.toolbarPosition==="top"?V():null,e.loading?g(Et,{class:D("loading")},null):null,(o=a["columns-top"])==null?void 0:o.call(a),Y(),(l=a["columns-bottom"])==null?void 0:l.call(a),e.toolbarPosition==="bottom"?V():null])}}});const oe=Mt(ne),ae={class:"canvas-container"},le={key:0,class:"tools-section"},se={class:"color-picker-container"},ie=G({__name:"signature",setup(e){let s=null,a=null;const d=P(!1),r=[{text:"5",value:5},{text:"10",value:10},{text:"15",value:15}],x=({selectedValues:n})=>{t.writeWidth=n[0],d.value=!1},b=()=>{d.value=!0},w=P("rgba(0, 0, 0, 1)"),m=P(["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsv(51, 100, 98)","hsva(120, 40, 94, 0.5)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"]),T=n=>{t.writeColor=n},h=P(!0),t={canvas:null,dpr:1,lastWriteSpeed:1,lastWriteWidth:1,isDpr:!1,isSign:!0,isWrite:!1,lastWriteTime:null,lastPoint:null,context:null,writeColor:"#000000",writeWidth:5,maxWriteWidth:5,minWriteWidth:1,lineCap:"round",lineJoin:"round",bgColor:"#fff",src:""},_=()=>{t.context.beginPath(),t.context.strokeStyle=t.writeColor,t.context.lineCap=t.lineCap,t.context.lineJoin=t.lineJoin},I=n=>{t.isWrite=!0,t.lastWriteTime=Date.now(),t.lastPoint=n,_()},L=n=>{const i=n.targetTouches[0],f=C(i);I(f)},W=n=>{const{offsetTop:i,offsetLeft:f}=n,p={top:i,left:f};let v=n.offsetParent;for(;v;)p.top+=v.offsetTop,p.left+=v.offsetLeft,v=v.offsetParent;return p},C=n=>{const{left:i,top:f}=t.canvas.getBoundingClientRect(),p=W(n.target),{clientX:v,clientY:y,pageX:$,pageY:k}=n,M=v?v-i:$-p.left,Z=y?y-f:k-p.top;return{x:M,y:Z}},U=()=>{const n=Date.now(),{isSign:i,writeWidth:f}=t;if(i){t.context.lineWidth=f*t.dpr,t.lastWriteTime=n;return}const{lastWriteTime:p,minWriteWidth:v,maxWriteWidth:y}=t,$=n-p;t.lastWriteTime=n;let k=v+(y-v)*$/30;k<v?k=v:k>y&&(k=y),k=k.toFixed(2);const{lastWriteWidth:M}=t,Z=t.lastWriteWidth=M/4*3+k/4;t.context.lineWidth=Z*t.dpr},E=n=>{t.context.moveTo(t.lastPoint.x*t.dpr,t.lastPoint.y*t.dpr),t.context.lineTo(n.x*t.dpr,n.y*t.dpr),U(),t.context.stroke(),t.lastPoint=n,t.context.closePath()},R=n=>{I({x:n.offsetX||n.clientX,y:n.offsetY||n.clientY})},F=n=>{t.isWrite&&E({x:n.offsetX,y:n.offsetY})},N=n=>{const i=n.targetTouches[0],f=C(i);t.isWrite&&E(f),h.value=!1},K=()=>{t.src=t.canvas.toDataURL()},Y=n=>{t.isWrite=!1,t.lastPoint=n,K(),h.value=!0,a&&clearTimeout(a),a=setTimeout(()=>{s.emit("canvas",t.src)},1e3)},V=n=>{const i=(n.targetTouches||[])[0]||(n.changedTouches||[])[0],f=C(i);Y(f)},S=()=>{t.context.save(),t.context.strokeStyle=t.writeColor,t.context.clearRect(0,0,t.canvas.width,t.canvas.height),t.context.fillStyle=t.bgColor,t.context.fillRect(0,0,t.canvas.width,t.canvas.height),t.isData=!1,t.context.restore()},u=()=>{var n=document.querySelector(".canvas-container"),i=document.getElementById("app-sign-canvas"),f=n.offsetWidth-10,p=n.offsetWidth*(3/5);return i.width=f,i.height=p,i},o=(n,i)=>{if(n)return new Promise((f,p)=>{const v=document.createElement("canvas"),y=new Image;y.src=n,y.onload=()=>{let $=y.naturalWidth,k=y.naturalHeight;i?(v.width=$,v.height=$*3/5):(v.width=k,v.height=$);const M=v.getContext("2d");i?(M.translate(0,v.height),M.rotate(-Math.PI/2)):(M.translate(v.width,0),M.rotate(Math.PI/2)),M.drawImage(y,0,0),f(v.toDataURL())},y.onerror=p})};let l="normal";const c=async()=>{var n=document.getElementById("app-sign-canvas");if(l==="normal"){l="full",n.height=n.width*(5/3);const i=new Image,f=await o(t.src,!1);i.src=f,i.onload=function(){t.context.drawImage(i,0,0)}}else{l="normal",n.height=n.width*(3/5);const i=new Image,f=await o(t.src,!0);i.src=f,i.onload=function(){t.context.drawImage(i,0,0)}}},O=()=>{t.canvas=u(),t.canvas&&(t.canvas.onmousedown=function(n){R(n)},t.canvas.onmousemove=function(n){F(n)},t.canvas.onmouseup=function(n){Y({x:n.offsetX,y:n.offsetY})},t.canvas.onmouseleave=function(n){t.isWrite=!1,t.lastPoint={x:n.offsetX,y:n.offsetY}},t.canvas.ontouchstart=function(n){L(n)},t.canvas.ontouchmove=function(n){n.preventDefault(),N(n)},t.canvas.ontouchend=V,t.context=t.canvas.getContext("2d"),t.canvas.style.background=t.bgColor,window.addEventListener("resize",function(){S(),u()}))};return Nt(()=>{O(),s=kt(`https://admin.iicoom.fun?userId=${(Math.random()*100).toString().slice(0,5)}`),s.on("canvas-data",n=>{const i=new Image;i.src=n,i.onload=function(){t.context.drawImage(i,0,0)}})}),(n,i)=>{const f=Lt("el-color-picker");return rt(),ut("div",ae,[h.value?(rt(),ut("div",le,[H("div",se,[g(f,{modelValue:w.value,"onUpdate:modelValue":i[0]||(i[0]=p=>w.value=p),"show-alpha":"",predefine:m.value,onActiveChange:T},null,8,["modelValue","predefine"])]),H("div",{class:"brush-size-container"},[H("i",{class:"iconfont",innerHTML:"",onClick:b})]),H("div",{class:"clear"},[H("i",{class:"iconfont",innerHTML:"",onClick:S})]),H("div",{id:"full-btn"},[H("i",{class:"iconfont",innerHTML:"",onClick:c})])])):Vt("",!0),i[3]||(i[3]=H("canvas",{id:"app-sign-canvas"},null,-1)),g(dt(Dt),{show:d.value,"onUpdate:show":i[2]||(i[2]=p=>d.value=p),round:"",position:"bottom"},{default:$t(()=>[g(dt(oe),{title:"brush size",columns:r,onCancel:i[1]||(i[1]=p=>d.value=!1),onConfirm:x})]),_:1},8,["show"])])}}});const ve=Rt(ie,[["__scopeId","data-v-0950bd31"]]);export{ve as default};
