import{$ as b,G as z,_ as q}from"./index-a9d270ce.js";import{G as E}from"./index-ed9aaca8.js";import{G as h}from"./index-4972ca34.js";import{k as y,d as N,r,o as H,z as W,D as I,E as w,f as a,v as s,B as t,C as d,L as n,J as c,q as J,ap as P,a7 as x}from"./element-plus-40d2da59.js";import{_ as j}from"./AiEditor.vue_vue_type_script_setup_true_lang-95ba90b7.js";import"./echarts-71ab4440.js";const A=y([{label:"文件名",prop:"path"},{label:"版本",prop:"version",width:"100px"},{label:"平台",prop:"platform",width:"100px"},{label:"架构",prop:"arch",width:"100px"},{label:"更新内容",prop:"note",tdSlot:"note"},{label:"状态",prop:"status",tdSlot:"status",width:"100px"},{label:"强制更新",prop:"forceUpdate",tdSlot:"forceUpdate",width:"100px"},{label:"创建时间",prop:"create_time",tdSlot:"createTime",width:"200px"},{label:"操作",prop:"operate",tdSlot:"operate",align:"center",fixed:"right",width:"200px"}]),K=y([{field:"note",type:"input",label:"更新内容"},{field:"platform",type:"select",label:"平台",options:[{label:"Windows",value:"Windows"},{label:"Linux",value:"Linux"},{label:"Mac",value:"Mac"}]}]),O={class:"page-container"},Q={class:"tool-bar"},X=["innerHTML"],Y={class:"text-right"},Z=N({__name:"versionList",setup(ee){const V=r(),p=r(),u=r(!1),C=r();H(()=>{f()});function T(){p.value.pagination.page=1,f()}const k=r([]),v=r(!1);async function f(){v.value=!0;const l={...V.value.formFieldsValue,page:p.value.pagination.page,size:p.value.pagination.size},e=await b.sendRequest("GetVersion",l);k.value=e.list,p.value.pagination.total=e.total,v.value=!1}let i=r({});const R=y({}),L=l=>{u.value=!0,i.value={...l,id:l._id},J(()=>{C.value.setContent(l.note)})},S=l=>{i.value.note=l},$=l=>{P.confirm(`确定要删除 【${l.platform}-${l.version}】？`,"Tips",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{await b.sendRequest("DeleteVersion",{id:l._id}),x.success("删除成功"),f()}).catch(e=>{console.error(e),x({type:"info",message:"取消删除"})})},B=async()=>{await b.sendRequest("UpdateVersion",i.value),x.success("保存成功"),u.value=!1,f()};return(l,e)=>{const F=d("el-tag"),m=d("el-button"),g=d("el-form-item"),_=d("el-radio"),U=d("el-radio-group"),G=d("el-form"),M=d("el-dialog");return W(),I("div",O,[w("div",Q,[a(h,{ref_key:"gtfRef",ref:V,"form-fields":s(K),onTableFilter:T},null,8,["form-fields"])]),a(E,{ref_key:"gtRef",ref:p,loading:v.value,columns:s(A),tableData:k.value,onPageChange:f,onSizeChange:T},{status:t(o=>[a(F,{type:o.row.status==1?"success":"danger"},{default:t(()=>[n(c(o.row.status==1?"启用":"禁用"),1)]),_:2},1032,["type"])]),forceUpdate:t(o=>[n(c(o.row.forceUpdate==1?"是":"否"),1)]),createTime:t(o=>[n(c(s(z).formatTime(o.row.create_time)),1)]),updateTime:t(o=>[n(c(s(z).formatTime(o.row.update_time)),1)]),note:t(o=>[w("div",{innerHTML:o.row.note},null,8,X)]),operate:t(o=>[a(m,{size:"small",type:"primary",onClick:D=>L(o.row)},{default:t(()=>e[4]||(e[4]=[n("编辑")])),_:2},1032,["onClick"]),a(m,{size:"small",type:"danger",onClick:D=>$(o.row)},{default:t(()=>e[5]||(e[5]=[n("删除")])),_:2},1032,["onClick"])]),_:1},8,["loading","columns","tableData"]),a(M,{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=o=>u.value=o),title:"版本编辑",width:"800"},{default:t(()=>[a(G,{model:s(i),ref:"versionFormRef",rules:R,"label-width":"auto","label-position":"top"},{default:t(()=>[a(g,{label:"更新内容",prop:"note"},{default:t(()=>[a(j,{ref_key:"contentRef",ref:C,onChange:S},null,512)]),_:1}),a(g,{label:"状态",prop:"status"},{default:t(()=>[a(U,{modelValue:s(i).status,"onUpdate:modelValue":e[0]||(e[0]=o=>s(i).status=o)},{default:t(()=>[a(_,{value:1,size:"large"},{default:t(()=>e[6]||(e[6]=[n("启用")])),_:1}),a(_,{value:0,size:"large"},{default:t(()=>e[7]||(e[7]=[n("禁用")])),_:1})]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"强制更新",prop:"forceUpdate"},{default:t(()=>[a(U,{modelValue:s(i).forceUpdate,"onUpdate:modelValue":e[1]||(e[1]=o=>s(i).forceUpdate=o)},{default:t(()=>[a(_,{value:1,size:"large"},{default:t(()=>e[8]||(e[8]=[n("是")])),_:1}),a(_,{value:0,size:"large"},{default:t(()=>e[9]||(e[9]=[n("否")])),_:1})]),_:1},8,["modelValue"])]),_:1}),w("div",Y,[a(m,{type:"primary",onClick:B},{default:t(()=>e[10]||(e[10]=[n("保存")])),_:1}),a(m,{onClick:e[2]||(e[2]=o=>u.value=!1)},{default:t(()=>e[11]||(e[11]=[n("取消")])),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});const ie=q(Z,[["__scopeId","data-v-ae429f4c"]]);export{ie as default};
