import{P as O}from"./PicUpload-e84cb849.js";import{i as G,G as P,$ as M,R as Q}from"./index-842d9a02.js";import{d as D,r as R,C as f,z as y,A as j,B as o,f as n,L as i,v as z,au as W,E,D as q,F as V,G as X,J as Y,S as Z,o as ee}from"./element-plus-40d2da59.js";import"./echarts-71ab4440.js";const te=D({__name:"PicMultiUpload",props:{sign:String},emits:["result"],setup(C,{expose:x,emit:w}){const _={Authorization:"Bearer "+localStorage.getItem("token")};x({init:g});const h=C,r=w,v=R(),$=(c,l)=>{r("result",l.map(p=>{var s;return(s=p.response)==null?void 0:s.url}),h.sign)};function k(c,l,p){p.filter(s=>s.status==="success").length===p.length&&r("result",p.map(s=>{var t;return(t=s.response)==null?void 0:t.url}),h.sign)}function e(c,l,p){}function g(c){v.value=c.map((l,p)=>({uid:p,success:!0,url:l,response:{url:l}}))}return(c,l)=>{const p=f("el-button"),s=f("el-upload");return y(),j(s,{class:"upload-demo","file-list":v.value,"onUpdate:fileList":l[0]||(l[0]=t=>v.value=t),action:z(G).upload_url,"on-remove":$,"list-type":"picture",accept:"image/*",multiple:"",limit:10,headers:_,"on-success":k,"on-error":e},{default:o(()=>[n(p,{type:"primary"},{default:o(()=>l[1]||(l[1]=[i("点击上传")])),_:1})]),_:1},8,["file-list","action"])}}}),ne=D({__name:"DragUpload",setup(C){const x={Authorization:"Bearer "+localStorage.getItem("token")};return(w,_)=>{const h=f("el-icon"),r=f("el-upload");return y(),j(r,{drag:"",action:z(G).upload_url,multiple:"",headers:x},{default:o(()=>[n(h,{class:"el-icon--upload"},{default:o(()=>[n(z(W))]),_:1}),_[0]||(_[0]=E("div",{class:"el-upload__text"},[i(" Drop file here or "),E("em",null,"click to upload")],-1))]),_:1},8,["action"])}}}),se={key:0,class:"list_wrapper"},oe={class:"file_name"},A=3,le=D({__name:"SliceUpload",props:{sign:String},emits:["result"],setup(C,{expose:x,emit:w}){x({init:c});const _=C,h=w,r=R([]),v=R(!1),$=(s,t)=>{h("result",t.map(u=>{var d;return(d=u.response)==null?void 0:d.url}),_.sign)};function k(s,t,u){u.filter(d=>d.status==="success").length===u.length&&h("result",u.map(d=>{var b;return(b=d.response)==null?void 0:b.url}),_.sign)}function e(s,t,u){}function g(){console.log("exceed"),P.$message.warning(`最多选择${A}个文件！`)}function c(s){r.value=s.map((t,u)=>({uid:u,success:!0,url:t,response:{url:t}}))}async function l(s){let t=s.raw;if(!t)return;let u=1024*1024,d=[];if(s.point===t.size){s.percentage=100;const a={filename:s.name},m=await M.sendRequest("MergeSlice",a);m&&P.$message.success(m.message);return}for(let a=s.point;a<t.size;a+=u)d.push({hash:s.hash++,chunk:t.slice(a,a+u)});const b=async function(a,m){if(a.length===0){const F={filename:m.name},S=await M.sendRequest("MergeSlice",F);S&&P.$message.success(S.message);return}let U=[],T=3,N=0,I=[];for(let F=0;F<a.length;F++){let S=a[F],B=new FormData;B.append("filename",t.name),B.append("hash",S.hash),B.append("chunk",S.chunk);let J={"Content-Type":"application/x-www-form-urlencoded"},L=M.sendRequest("SliceUpload",B,J,"");L.then(()=>{let H=U.findIndex(K=>K===L);U.splice(H)}).catch(()=>{I.push(S)}).finally(()=>{N++,m.point+=u,m.percentage=m.point/t.size>1?100:parseFloat((m.point/t.size*100).toFixed(2)),N===a.length&&b(I,m)}),U.push(L),U.length===T&&await Promise.race(U)}};d.length>0&&b(d,s)}async function p(){v.value=!0;for(const s of r.value){const t=await M.sendRequest("CheckPoint",{filename:s.raw.name},"",!1);t&&t.success?(s.point=t.point,s.hash=t.hash,await l(s)):P.$message.error(t)}}return(s,t)=>{const u=f("el-button"),d=f("el-upload"),b=f("el-progress");return y(),q(V,null,[n(d,{"file-list":r.value,"onUpdate:fileList":t[0]||(t[0]=a=>r.value=a),action:"xxx",multiple:"","http-request":()=>{},"on-remove":$,limit:A,"on-success":k,"on-error":e,"on-exceed":g,"show-file-list":!v.value},{trigger:o(()=>[n(u,{type:"primary"},{default:o(()=>t[1]||(t[1]=[i("选择文件")])),_:1})]),default:o(()=>[n(u,{type:"primary",disabled:!r.value.length,onClick:p,style:{"margin-left":"10px"}},{default:o(()=>t[2]||(t[2]=[i(" 上传到服务器 ")])),_:1},8,["disabled"])]),_:1},8,["file-list","show-file-list"]),v.value?(y(),q("div",se,[(y(!0),q(V,null,X(r.value,(a,m)=>(y(),q("div",{class:"file_item",key:m},[E("div",oe,Y(z(P).niceName(a.name,25)),1),a.percentage===100?(y(),j(b,{key:0,percentage:100,status:"success"})):(y(),j(b,{key:1,percentage:a.percentage},null,8,["percentage"]))]))),128))])):Z("",!0)],64)}}}),ae={class:"page-container"},ce=D({__name:"UploadComponent",setup(C){ee(()=>{x.value.init("https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"),w.value.init(["https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100","https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100"])});const x=R(),w=R(),_=R();function h(k,e){console.log("setPic",k,e)}function r(k,e){console.log("setPics",k,e)}const v=R(),$=()=>{v.value.show()};return(k,e)=>{const g=f("el-divider"),c=f("el-tag"),l=f("el-col"),p=f("el-button"),s=f("el-row");return y(),q("div",ae,[n(s,{gutter:20},{default:o(()=>[n(l,{span:12},{default:o(()=>[n(g,{"content-position":"left"},{default:o(()=>e[0]||(e[0]=[i("单图片上传")])),_:1}),n(c,{class:"desc"},{default:o(()=>e[1]||(e[1]=[i("适用于上传用户头像、商品、课程缩略图等")])),_:1}),n(O,{ref_key:"pu",ref:x,sign:"avatar",onResult:h},null,512)]),_:1}),n(l,{span:12},{default:o(()=>[n(g,{"content-position":"left"},{default:o(()=>e[2]||(e[2]=[i("多图片上传")])),_:1}),n(c,{class:"desc"},{default:o(()=>e[3]||(e[3]=[i("适用于一次性批量上传多张图片")])),_:1}),n(te,{ref_key:"pmu",ref:w,sign:"poster",onResult:r},null,512)]),_:1}),n(l,{span:12},{default:o(()=>[n(g,{"content-position":"left"},{default:o(()=>e[4]||(e[4]=[i("拖拽上传")])),_:1}),n(c,{class:"desc"},{default:o(()=>e[5]||(e[5]=[i("可放置区域，适用于将文件拖动到此处上传")])),_:1}),n(ne,{ref:"du",sign:"drag",onResult:r},null,512)]),_:1}),n(l,{span:12},{default:o(()=>[n(g,{"content-position":"left"},{default:o(()=>e[6]||(e[6]=[i("图片裁剪后上传")])),_:1}),n(z(Q),{to:"/profile"},{default:o(()=>[n(c,{class:"desc"},{default:o(()=>e[7]||(e[7]=[i("参考个人中心头像上传")])),_:1})]),_:1})]),_:1}),n(l,{span:24},{default:o(()=>[n(g,{"content-position":"left"},{default:o(()=>e[8]||(e[8]=[i("大文件分片、断点续传")])),_:1}),n(c,{class:"desc"},{default:o(()=>e[9]||(e[9]=[i(" 大文件上传会消耗大量的时间，而且中途有可能上传失败。为了解决这个问题，可以使用分片上传，断点续传。 ")])),_:1}),n(le,{ref_key:"su",ref:_,sign:"slice",onResult:r},null,512)]),_:1}),n(l,{span:24},{default:o(()=>[n(g,{"content-position":"left"},{default:o(()=>e[10]||(e[10]=[i("数据批量导入")])),_:1}),n(p,{type:"primary",onClick:$},{default:o(()=>e[11]||(e[11]=[i("批量导入")])),_:1})]),_:1})]),_:1})])}}});export{ce as default};
