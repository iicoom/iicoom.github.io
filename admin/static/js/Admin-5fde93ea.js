import{G as N,_ as te,$ as C}from"./index-a763790d.js";import{d as Y,z as i,D as h,J as j,k as R,r as u,o as oe,E as q,f as o,v as n,B as t,ap as ne,a7 as M,C as d,L as m,as as se,A as f,F as E,G as L}from"./element-plus-b1d7f0ee.js";import{G as re}from"./index-8dea061c.js";import{G as ie}from"./index-a5eb19a0.js";import"./echarts-71ab4440.js";const de=Y({__name:"VatAvatar",props:{username:{type:String,required:!0},size:{type:Number,default:30},backgroundColor:String,color:String},setup(v){const r=v,c={width:r.size+"px",height:r.size+"px",lineHeight:r.size+"px",fontSize:r.size*.47+"px",backgroundColor:r.backgroundColor?r.backgroundColor:N.getRandomColor(),color:r.color?r.color:"#fff"};return(b,k)=>(i(),h("div",{class:"vat-avatar",style:c},j(r.username.slice(0,1)),1))}});const ue=te(de,[["__scopeId","data-v-f9061160"]]),pe=R([{label:"",prop:"",type:"selection"},{label:"管理员ID",prop:"id",width:"120px",showTooltip:!0,sortable:!0},{label:"头像",prop:"avatar",tdSlot:"avatar"},{label:"用户名",prop:"name",width:"200px"},{label:"密码",prop:"plain_password",width:"200px"},{label:"key",prop:"key",width:"200px"},{label:"有效期",prop:"valid_date",width:"200px"},{label:"手机号",prop:"phone",width:"200px"},{label:"可用角色",prop:"roles",width:"200px",tdSlot:"roles"},{label:"账号状态",prop:"status",width:"200px",tdSlot:"status",filters:[{text:"正常",value:1},{text:"禁用",value:2}],filtersMethod:(v,r)=>r.status===v,selectable:(v,r)=>v.status===1},{label:"操作",prop:"operate",width:"130px",tdSlot:"operate",fixed:"right",align:"center"}]),me=R([{field:"name",type:"input",label:"用户名"},{field:"phone",type:"input",label:"手机号"},{field:"status",type:"select",label:"账号状态",options:[{value:1,label:"正常"},{value:2,label:"禁用"}]}]),fe={class:"page-container"},ce={class:"tool-bar"},_e={class:"dialog-footer"},ke=Y({__name:"Admin",setup(v){const r=u(),c=u(),b=u(!1),k=u("新增"),S=u(),G=u(),z=u(!1);oe(()=>{J(),g(),N.getPlatform()!=="pc"?z.value=!0:z.value=!1});const V=u();let a=R({id:0,name:"",phone:"",password:"",new_pass:"",status:1,role_id:0,available_role_ids:[],key:"",valid_date:""});const H=R({name:[{required:!0,message:"请输入"}],password:[{required:!0,message:"请输入"}]});function U(){c.value.pagination.page=1,g()}const O=s=>{s&&s.resetFields()};function I(s){s&&s.validate(async(e,_)=>{if(e){let y="AddAdmin";a.id?y="UpdateAdmin":y="AddAdmin",await C.sendRequest(y,a)&&(M({message:"操作成功",type:"success"}),A(s),g())}else console.log("error submit!",_)})}function $(){b.value=!0}function A(s){O(s),Object.keys(a).forEach(e=>{a[e]=""}),b.value=!1}function P(){k.value="新增",$()}function B(s){k.value="编辑",Object.keys(s).forEach(e=>{a[e]=s[e]}),$()}async function J(){const s=await C.sendRequest("GetRoles",{});G.value=s.list}const D=u(!1);async function g(){D.value=!0;const s={...r.value.formFieldsValue,page:c.value.pagination.page,size:c.value.pagination.size},e=await C.sendRequest("GetAdmins",s);S.value=e.list,c.value.pagination.total=e.total,D.value=!1}function T(s){ne.confirm(`确定要删除用户【${s.name}】？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{await C.sendRequest("DeleteAdmin",{id:s.id})&&(M({type:"success",message:"操作成功"}),g())}).catch(()=>{})}function K(){a.available_role_ids.length&&(a.role_id=a.available_role_ids.at(-1)||0)}return(s,e)=>{const _=d("el-button"),y=d("el-avatar"),x=d("el-tag"),w=d("el-input"),p=d("el-form-item"),Q=d("el-option"),W=d("el-select"),X=d("el-switch"),Z=d("el-date-picker"),ee=d("el-form"),le=d("el-dialog");return i(),h("div",fe,[q("div",ce,[o(ie,{ref_key:"gtfRef",ref:r,"form-fields":n(me),onTableFilter:U},null,8,["form-fields"]),o(_,{type:"primary",icon:n(se),onClick:P},{default:t(()=>e[12]||(e[12]=[m("新增")])),_:1},8,["icon"])]),o(re,{ref_key:"gtRef",ref:c,loading:D.value,columns:n(pe),tableData:S.value,onHandleEdit:B,onHandleDelete:T,onPageChange:g,onSizeChange:U},{avatar:t(l=>[l.row.avatar?(i(),f(y,{key:0,size:30,src:l.row.avatar},null,8,["src"])):(i(),f(ue,{key:1,username:l.row.name,size:30},null,8,["username"]))]),roles:t(l=>[(i(!0),h(E,null,L(l.row.roles,(F,ae)=>(i(),f(x,{type:"warning",key:ae},{default:t(()=>[m(j(F),1)]),_:2},1024))),128))]),status:t(l=>[l.row.status===2?(i(),f(x,{key:0,type:"danger"},{default:t(()=>e[13]||(e[13]=[m("禁用")])),_:1})):(i(),f(x,{key:1,type:"success"},{default:t(()=>e[14]||(e[14]=[m("正常")])),_:1}))]),operate:t(l=>[o(_,{type:"primary",link:"",onClick:F=>B(l.row)},{default:t(()=>e[15]||(e[15]=[m("编辑")])),_:2},1032,["onClick"]),o(_,{type:"danger",link:"",onClick:F=>T(l.row)},{default:t(()=>e[16]||(e[16]=[m("删除")])),_:2},1032,["onClick"])]),_:1},8,["loading","columns","tableData"]),o(le,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=l=>b.value=l),title:k.value,center:"",fullscreen:z.value,"close-on-click-modal":!1,"destroy-on-close":"",onClose:e[11]||(e[11]=l=>A(V.value))},{footer:t(()=>[q("span",_e,[o(_,{onClick:e[8]||(e[8]=l=>A(V.value))},{default:t(()=>e[17]||(e[17]=[m("取消")])),_:1}),o(_,{type:"primary",onClick:e[9]||(e[9]=l=>I(V.value))},{default:t(()=>e[18]||(e[18]=[m("确认")])),_:1})])]),default:t(()=>[o(ee,{model:n(a),ref_key:"ruleFormRef",ref:V,"label-width":"auto",rules:H},{default:t(()=>[o(p,{label:"姓名",prop:"name"},{default:t(()=>[o(w,{modelValue:n(a).name,"onUpdate:modelValue":e[0]||(e[0]=l=>n(a).name=l)},null,8,["modelValue"])]),_:1}),o(p,{label:"手机号",prop:"phone"},{default:t(()=>[o(w,{modelValue:n(a).phone,"onUpdate:modelValue":e[1]||(e[1]=l=>n(a).phone=l)},null,8,["modelValue"])]),_:1}),n(a).id?(i(),f(p,{key:0,label:"重置密码",prop:"new_pass"},{default:t(()=>[o(w,{modelValue:n(a).new_pass,"onUpdate:modelValue":e[2]||(e[2]=l=>n(a).new_pass=l),placeholder:"无需重置请留空","show-password":"",clearable:"",type:"password"},null,8,["modelValue"])]),_:1})):(i(),f(p,{key:1,label:"密码",prop:"password"},{default:t(()=>[o(w,{modelValue:n(a).password,"onUpdate:modelValue":e[3]||(e[3]=l=>n(a).password=l),placeholder:"","show-password":"",clearable:"",type:"password"},null,8,["modelValue"])]),_:1})),o(p,{label:"角色",prop:"available_role_ids"},{default:t(()=>[o(W,{clearable:"",modelValue:n(a).available_role_ids,"onUpdate:modelValue":e[4]||(e[4]=l=>n(a).available_role_ids=l),onChange:K,multiple:"",placeholder:"选择角色",style:{width:"50%"}},{default:t(()=>[(i(!0),h(E,null,L(G.value,l=>(i(),f(Q,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(p,{label:"账号状态"},{default:t(()=>[o(X,{modelValue:n(a).status,"onUpdate:modelValue":e[5]||(e[5]=l=>n(a).status=l),"active-value":1,"inactive-value":2},null,8,["modelValue"])]),_:1}),o(p,{label:"key"},{default:t(()=>[o(w,{modelValue:n(a).key,"onUpdate:modelValue":e[6]||(e[6]=l=>n(a).key=l),placeholder:"",clearable:"",type:"textarea",autosize:""},null,8,["modelValue"])]),_:1}),o(p,{label:"有效期"},{default:t(()=>[o(Z,{modelValue:n(a).valid_date,"onUpdate:modelValue":e[7]||(e[7]=l=>n(a).valid_date=l),type:"date",placeholder:"套餐有效期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title","fullscreen"])])}}});export{ke as default};
