var oe=Object.defineProperty;var ne=(o,e,t)=>e in o?oe(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var p=(o,e,t)=>(ne(o,typeof e!="symbol"?e+"":e,t),t),W=(o,e,t)=>{if(!e.has(o))throw TypeError("Cannot "+t)};var a=(o,e,t)=>(W(o,e,"read from private field"),t?t.call(o):e.get(o)),L=(o,e,t)=>{if(e.has(o))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(o):e.set(o,t)},B=(o,e,t,r)=>(W(o,e,"write to private field"),r?r.call(o,t):e.set(o,t),t);import{d as re,r as j,o as ae,z as M,D as se,E as y,f as U,B as g,v as F,A as G,J as ie,a7 as b,C as X,L as D}from"./element-plus-b1d7f0ee.js";import{_ as le}from"./index-a763790d.js";import"./echarts-71ab4440.js";var l;(function(o){o.LOAD="LOAD",o.EXEC="EXEC",o.FFPROBE="FFPROBE",o.WRITE_FILE="WRITE_FILE",o.READ_FILE="READ_FILE",o.DELETE_FILE="DELETE_FILE",o.RENAME="RENAME",o.CREATE_DIR="CREATE_DIR",o.LIST_DIR="LIST_DIR",o.DELETE_DIR="DELETE_DIR",o.ERROR="ERROR",o.DOWNLOAD="DOWNLOAD",o.PROGRESS="PROGRESS",o.LOG="LOG",o.MOUNT="MOUNT",o.UNMOUNT="UNMOUNT"})(l||(l={}));const de=(()=>{let o=0;return()=>o++})(),ce=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),ue=new Error("called FFmpeg.terminate()");var m,v,h,I,A,N,f;class pe{constructor(){L(this,m,null);L(this,v,{});L(this,h,{});L(this,I,[]);L(this,A,[]);p(this,"loaded",!1);L(this,N,()=>{a(this,m)&&(a(this,m).onmessage=({data:{id:e,type:t,data:r}})=>{switch(t){case l.LOAD:this.loaded=!0,a(this,v)[e](r);break;case l.MOUNT:case l.UNMOUNT:case l.EXEC:case l.FFPROBE:case l.WRITE_FILE:case l.READ_FILE:case l.DELETE_FILE:case l.RENAME:case l.CREATE_DIR:case l.LIST_DIR:case l.DELETE_DIR:a(this,v)[e](r);break;case l.LOG:a(this,I).forEach(s=>s(r));break;case l.PROGRESS:a(this,A).forEach(s=>s(r));break;case l.ERROR:a(this,h)[e](r);break}delete a(this,v)[e],delete a(this,h)[e]})});L(this,f,({type:e,data:t},r=[],s)=>a(this,m)?new Promise((c,E)=>{const R=de();a(this,m)&&a(this,m).postMessage({id:R,type:e,data:t},r),a(this,v)[R]=c,a(this,h)[R]=E,s==null||s.addEventListener("abort",()=>{E(new DOMException(`Message # ${R} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(ce));p(this,"load",({classWorkerURL:e,...t}={},{signal:r}={})=>(a(this,m)||(B(this,m,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/spa/assets/worker-224792ee.js",self.location),{type:"module"})),a(this,N).call(this)),a(this,f).call(this,{type:l.LOAD,data:t},void 0,r)));p(this,"exec",(e,t=-1,{signal:r}={})=>a(this,f).call(this,{type:l.EXEC,data:{args:e,timeout:t}},void 0,r));p(this,"ffprobe",(e,t=-1,{signal:r}={})=>a(this,f).call(this,{type:l.FFPROBE,data:{args:e,timeout:t}},void 0,r));p(this,"terminate",()=>{const e=Object.keys(a(this,h));for(const t of e)a(this,h)[t](ue),delete a(this,h)[t],delete a(this,v)[t];a(this,m)&&(a(this,m).terminate(),B(this,m,null),this.loaded=!1)});p(this,"writeFile",(e,t,{signal:r}={})=>{const s=[];return t instanceof Uint8Array&&s.push(t.buffer),a(this,f).call(this,{type:l.WRITE_FILE,data:{path:e,data:t}},s,r)});p(this,"mount",(e,t,r)=>{const s=[];return a(this,f).call(this,{type:l.MOUNT,data:{fsType:e,options:t,mountPoint:r}},s)});p(this,"unmount",e=>{const t=[];return a(this,f).call(this,{type:l.UNMOUNT,data:{mountPoint:e}},t)});p(this,"readFile",(e,t="binary",{signal:r}={})=>a(this,f).call(this,{type:l.READ_FILE,data:{path:e,encoding:t}},void 0,r));p(this,"deleteFile",(e,{signal:t}={})=>a(this,f).call(this,{type:l.DELETE_FILE,data:{path:e}},void 0,t));p(this,"rename",(e,t,{signal:r}={})=>a(this,f).call(this,{type:l.RENAME,data:{oldPath:e,newPath:t}},void 0,r));p(this,"createDir",(e,{signal:t}={})=>a(this,f).call(this,{type:l.CREATE_DIR,data:{path:e}},void 0,t));p(this,"listDir",(e,{signal:t}={})=>a(this,f).call(this,{type:l.LIST_DIR,data:{path:e}},void 0,t));p(this,"deleteDir",(e,{signal:t}={})=>a(this,f).call(this,{type:l.DELETE_DIR,data:{path:e}},void 0,t))}on(e,t){e==="log"?a(this,I).push(t):e==="progress"&&a(this,A).push(t)}off(e,t){e==="log"?B(this,I,a(this,I).filter(r=>r!==t)):e==="progress"&&B(this,A,a(this,A).filter(r=>r!==t))}}m=new WeakMap,v=new WeakMap,h=new WeakMap,I=new WeakMap,A=new WeakMap,N=new WeakMap,f=new WeakMap;var $;(function(o){o.MEMFS="MEMFS",o.NODEFS="NODEFS",o.NODERAWFS="NODERAWFS",o.IDBFS="IDBFS",o.WORKERFS="WORKERFS",o.PROXYFS="PROXYFS"})($||($={}));const fe=new Error("failed to get response body reader"),Ee=new Error("failed to complete download"),me="Content-Length",Re=o=>new Promise((e,t)=>{const r=new FileReader;r.onload=()=>{const{result:s}=r;s instanceof ArrayBuffer?e(new Uint8Array(s)):e(new Uint8Array)},r.onerror=s=>{var c,E;t(Error(`File could not be read! Code=${((E=(c=s==null?void 0:s.target)==null?void 0:c.error)==null?void 0:E.code)||-1}`))},r.readAsArrayBuffer(o)}),V=async o=>{let e;if(typeof o=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(o)?e=atob(o.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(o)).arrayBuffer();else if(o instanceof URL)e=await(await fetch(o)).arrayBuffer();else if(o instanceof File||o instanceof Blob)e=await Re(o);else return new Uint8Array;return new Uint8Array(e)},we=async(o,e)=>{var s;const t=await fetch(o);let r;try{const c=parseInt(t.headers.get(me)||"-1"),E=(s=t.body)==null?void 0:s.getReader();if(!E)throw fe;const R=[];let u=0;for(;;){const{done:O,value:C}=await E.read(),S=C?C.length:0;if(O){if(c!=-1&&c!==u)throw Ee;e&&e({url:o,total:c,received:u,delta:S,done:O});break}R.push(C),u+=S,e&&e({url:o,total:c,received:u,delta:S,done:O})}const k=new Uint8Array(u);let T=0;for(const O of R)k.set(O,T),T+=O.length;r=k.buffer}catch(c){console.log("failed to send download progress event: ",c),r=await t.arrayBuffer(),e&&e({url:o,total:r.byteLength,received:r.byteLength,delta:0,done:!0})}return r},J=async(o,e,t=!1,r)=>{const s=t?await we(o,r):await(await fetch(o)).arrayBuffer(),c=new Blob([s],{type:e});return URL.createObjectURL(c)},ye={class:"p-4"},be={class:"flex my-4"},he=["src"],Oe={id:"log"},Le=re({__name:"ScreenRecorder",setup(o){let e=null,t=null,r=j(!1),s=[],c=null;const E=j("");let R=j("");const u=new pe;let k=null;ae(()=>{c=document.getElementById("video"),document.getElementById("log")});const T={video:{cursor:"always"},audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}};async function O(){try{c.srcObject=await navigator.mediaDevices.getDisplayMedia(T),e=c.srcObject,C()}catch(i){console.error("Error: "+i)}}function C(){const i=c.srcObject.getVideoTracks()[0];console.info("Track settings:"),console.info(JSON.stringify(i.getSettings(),null,2)),console.info("Track constraints:"),console.info(JSON.stringify(i.getConstraints(),null,2))}function S(){if(!c.srcObject)return;c.srcObject.getTracks().forEach(n=>n.stop()),c.srcObject=null,b("用户停止了分享屏幕")}function P(){return["video/mp4;codecs=h264,aac","video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm;codecs=h264,opus"].filter(n=>MediaRecorder.isTypeSupported(n))}function z(){if(!e){b("请先开始捕获");return}if(r.value){b("正在录制中，请先停止录制");return}if(t){b("MediaRecorder已经存在，请先停止录制");return}console.log("mimeType",P());const n={mimeType:P()[0]};try{t=new MediaRecorder(e,n)}catch(d){b(`创建MediaRecorder出错: ${JSON.stringify(d)}`);return}r.value=!0,t.onstop=d=>{b("录制停止了: "+d)},t.ondataavailable=Y,t.start(),b("录制开始 mediaRecorder: "+t)}function Y(i){console.log("handleDataAvailable",i),i.data&&i.data.size>0&&s.push(i.data)}function H(){r.value=!1,t.stop(),s=[]}function K(){if(!s||s.length===0){b("没有录制数据");return}if(r.value){b("正在录制中，请先停止录制");return}const i=new Blob(s,{type:"video/webm"}),n=window.URL.createObjectURL(i),d=document.createElement("a");d.style.display="none",d.href=n,d.download="录屏_"+new Date().getTime()+".webm",document.body.appendChild(d),d.click(),setTimeout(()=>{document.body.removeChild(d),window.URL.revokeObjectURL(n)},100)}function q(i){const n=document.createElement("a");n.style.display="none",n.href=i,n.download="录屏_"+new Date().getTime()+".mp4",document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(i)},100)}const x=async()=>{E.value="Loading ffmpeg-core.js";const i="https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";u.on("log",({message:n})=>{console.log(n)}),await u.load({coreURL:await J(`${i}/ffmpeg-core.js`,"text/javascript"),wasmURL:await J(`${i}/ffmpeg-core.wasm`,"application/wasm")})};async function Z(){try{await x()}catch(d){console.error("Error loading ffmpeg-core.js:",d);return}E.value="Start transcoding",k=new Blob(s,{type:"video/webm"});const i=window.URL.createObjectURL(k);await u.writeFile("test.webm",await V(i)),await u.exec(["-i","test.webm","test.mp4"]),E.value="Complete transcoding";const n=await u.readFile("test.mp4");R.value=URL.createObjectURL(new Blob([n.buffer],{type:"video/mp4"})),q(R.value)}async function Q(i){await x(),await u.writeFile("input.mp4",await V(i)),await u.exec(["-i","input.mp4","-ss","00:00:00","-to","00:00:30","-c","copy","part1.mp4"]),await u.exec(["-i","input.mp4","-ss","00:00:30","-c","copy","part2.mp4"]);const n=await u.readFile("part1.mp4"),d=await u.readFile("part2.mp4"),w=new Blob([n.buffer],{type:"video/mp4"}),_=new Blob([d.buffer],{type:"video/mp4"});return[w,_]}async function ee(i){i.forEach((n,d)=>{const w=URL.createObjectURL(n),_=document.createElement("a");_.href=w,_.download=`video_segment_${d+1}.mp4`,document.body.appendChild(_),_.click(),setTimeout(()=>{document.body.removeChild(_),URL.revokeObjectURL(w)},100)})}const te=async()=>{var n,d;const i=(d=(n=document.getElementById("video-input"))==null?void 0:n.files)==null?void 0:d[0];try{const w=await Q(i);console.log("segments",w),await ee(w)}catch(w){console.error(w)}};return(i,n)=>{const d=X("el-button"),w=X("el-divider");return M(),se("div",ye,[n[8]||(n[8]=y("p",null," This example shows you the contents of the selected part of your display. Click the Start Capture button to begin. ",-1)),n[9]||(n[9]=y("q",null,"点击开始捕获按钮，选择你要捕获的窗口。",-1)),y("p",be,[U(d,{type:"primary",onClick:O},{default:g(()=>n[0]||(n[0]=[D("开始捕获")])),_:1}),U(d,{type:"primary",onClick:S},{default:g(()=>n[1]||(n[1]=[D("停止捕获")])),_:1}),F(r)?(M(),G(d,{key:0,type:"primary",onClick:H},{default:g(()=>n[2]||(n[2]=[D("停止录制")])),_:1})):(M(),G(d,{key:1,type:"primary",onClick:z},{default:g(()=>n[3]||(n[3]=[D("开始录制")])),_:1})),U(d,{type:"primary",onClick:K},{default:g(()=>n[4]||(n[4]=[D("下载")])),_:1}),U(d,{type:"primary",onClick:Z},{default:g(()=>n[5]||(n[5]=[D("转码")])),_:1})]),n[10]||(n[10]=y("video",{id:"video",autoplay:""},null,-1)),y("video",{id:"video-trans",src:F(R),controls:""},null,8,he),n[11]||(n[11]=y("br",null,null,-1)),n[12]||(n[12]=y("strong",null,"Log:",-1)),n[13]||(n[13]=y("br",null,null,-1)),y("pre",Oe,ie(E.value),1),U(w,null,{default:g(()=>n[6]||(n[6]=[D("分割线")])),_:1}),n[14]||(n[14]=y("input",{id:"video-input",type:"file"},null,-1)),U(d,{onClick:te},{default:g(()=>n[7]||(n[7]=[D("分割")])),_:1})])}}});const Ie=le(Le,[["__scopeId","data-v-ce7bcfad"]]);export{Ie as default};
